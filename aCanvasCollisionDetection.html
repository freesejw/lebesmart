<!DOCTYPE html>
<html>
<head>
<style>
body{ margin:10px; background:#CCC; }
#my_canvas{ background:#FFF; border:#000 1px solid; }
</style>
<script>
 
function initCanvas()
{
    var ctx = document.getElementById('my_canvas').getContext('2d');
    var cW = ctx.canvas.width, cH = ctx.canvas.height;
    var enemyPic1= new Image();
     enemyPic1.src="augeRot.gif";  
     var enemyPic2= new Image();
     enemyPic2.src="augeGruen.gif";   

     var yUnten=400; 
     var bullets=[];

    var enemies = [ {"id":"0","pic": enemyPic1,"x":100,"y":100,"w":50,"h":50},
                    {"id":"1","pic": enemyPic1,"x":225,"y":100,"w":50,"h":50},
                    {"id":"2","pic": enemyPic1,"x":350,"y":100,"w":50,"h":50},
                    {"id":"3","pic": enemyPic2,"x":100,"y":170,"w":50,"h":50},
                    {"id":"4","pic": enemyPic2,"x":225,"y":170,"w":50,"h":50},
                    {"id":"5","pic": enemyPic1,"x":350,"y":170,"w":50,"h":50},                 
                  ];

    function renderEnemies()
    {
        for(var i = 0; i < enemies.length; i++)
        {           
            ctx.drawImage(enemies[i].pic,enemies[i].x, enemies[i].y+=0.5, enemies[i].w, enemies[i].h);

            if(enemies[i].y>yUnten)
            {
            enemies.splice(i,1)
            }
        }
        
    }     
  
   function bullet()
   {
        if(Math.random()<0.03&& enemies.length>0)
        {
                var a =random(enemies.length-1); 

                for ( var i = 0; i <enemies.length;i++)
                {
                    var b = enemies[i].id;
                    console.log (a +"  "  + b );
                    console.log(enemies[a].x + "   " + enemies[a].y +  "   " + enemies[a].w + "   " + 120)
                    console.log(enemies[b].x + "   " + enemies[b].y + "   " +enemies[b].w +"   " + enemies[b].h);
                    var c= collision(enemies[a].x,enemies[a].y,enemies[a].w,220,enemies[b].x,enemies[b].y,enemies[b].w,enemies[b].h)
                   
                    console.log ("  c   " + c + "  i  " + i);
                    if (c)
                    {                    
                        a=b;
                        console.log("wechsel    !!!!!!!!!!!!!!!!!!!!!!zweiS  " +a + " i  "  + i);
                    }    
                  
                }
                    console.log("Entscheidung!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!eins  " +a + "   i  " + i);   
                    bullets.push({"x":enemies[a].x+enemies[a].w*.5,"y":enemies[a].y+50,"w":3,"h":10,"bg":"red"});  

                    for(var i=0; i < bullets.length; i++)
                    {
                        var m = bullets[i];
                        ctx.fillStyle = m.bg;
                        ctx.fillRect(m.x, m.y+=10, m.w, m.h);
                    }
              
                    }    
      
   }

    function Launcher(){
        this.y = 400, this.x = cW*.5-25, this.w = 50, this.h = 50, this.bg="orange", this.missiles = [];
        this.render = function(){
            
            ctx.fillStyle = this.bg;
            ctx.fillRect(this.x, this.y, this.w, this.h);
            for(var i=0; i < this.missiles.length; i++){
                var m = this.missiles[i];
                ctx.fillStyle = m.bg;
                ctx.fillRect(m.x, m.y-=5, m.w, m.h);
                this.hitDetect(this.missiles[i],i);               
                if(m.y <= 0){ // If a missile goes past the canvas boundaries, remove it
                    this.missiles.splice(i,1); // Splice that missile out of the missiles array
                }
            }
            if(enemies.length == 0){
                clearInterval(animateInterval); // Stop the game animation loop
                ctx.fillStyle = '#FC0';
                ctx.font = 'italic bold 36px Arial, sans-serif';
                ctx.fillText('Level Complete', cW*.5-130, 50, 300);
            }
        }
        this.hitDetect = function(m,mi){
            for(var i = 0; i < enemies.length; i++){
                var e = enemies[i];
                if(m.x+m.w >= e.x && m.x <= e.x+e.w && m.y >= e.y && m.y <= e.y+e.h){
                    this.missiles.splice(this.missiles[mi],1); // Remove the missile
                    enemies.splice(i,1); // Remove the enemy that the missile hit
               
                }
            }
        }
    }
    
    var launcher = new Launcher();

    function animate(){
        //ctx.save();
        ctx.clearRect(0, 0, cW, cH);
        launcher.render();
        renderEnemies();
        bullet();
       
        //ctx.restore();
    }
    var animateInterval = setInterval(animate, 30);
    document.addEventListener('keydown', function(event) {
        var key_press = String.fromCharCode(event.keyCode);
        //alert(event.keyCode+" | "+key_press);
        if(key_press == "%"){
            launcher.x-= 3;//left
        } else if(key_press == "'"){
            launcher.x+=3;
        } else if(key_press == "&"){
            launcher.missiles.push({"x":launcher.x+launcher.w*.5,"y":launcher.y,"w":3,"h":10,"bg":"red"});
        }
    
    });
    

    
}
function collision(ax,ay,aw,ah,bx,by,bw,bh){
    return ax <= bx+bw && bx <= ax+aw && ay <= by + bh && by <= ay+ah;
}

function random(max)
          {
            return Math.floor((Math.random() *max));
          }
window.addEventListener('load', function(event) {
    initCanvas();
});

 
</script>
</head>
<body>
<canvas id="my_canvas" width="500" height="600"></canvas>

</body>  
</html>