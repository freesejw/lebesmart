<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>brick</title>
    <style>
    	* { padding: 0; margin: 0; }
 Canvas {
   position: absolute;
   top: 10px;
   left: 10px;
   border: 1px red solid;
   background-color: #FFEFDB;
   } 
    
    </style>
</head>
<body>

<canvas id="myCanvas" width="500" height="600"></canvas>

<script>
	var canvas = document.getElementById("myCanvas");
var ctx = canvas.getContext("2d");
//var x = canvas.width/2;
//var y = canvas.height-30;
var xSpeed = 6;
var ySpeed= -6
var ballRadius=10;
var xLinks=20;
var xRechts=xLinks+ canvas.width-40;
var xBreite=canvas.width-60; 
var x = xBreite/2; 
var yUnten=450;
var y=300;
var yOben= 80;
var yHoehe=yUnten-yOben;

var paddleHeight = 10;
var paddleWidth = 60;
var paddleX = (xBreite-paddleWidth)/2;
var rightPressed = false;
var leftPressed = false;

var brickRowCount = 3;
var brickColumnCount = 5;
var brickWidth = 75;
var brickHeight = 20;
var brickPadding = 10;
var brickOffsetTop = 30;
var brickOffsetLeft = 30;
var score=0;
var Leben = 3;
var schrittWeite=1 ;
var stop=false;
var myVar;
var bgColor ="lightblue";
 var xBasis=20, yBasis=540, wBasis=120, hBasis=40, dBasis=40, xtextdis=20, ytextdis=25;
 var yErhoehung=50; 
 


var rects = [{x: xBasis, y: yBasis, w: wBasis, h: hBasis,col: bgColor},
             {x: (xBasis + wBasis+ dBasis), y: yBasis, w: wBasis, h: hBasis,col: bgColor},
             {x: (xBasis + 2 *( wBasis+ dBasis)), y: yBasis, w: wBasis, h: hBasis,col: bgColor}];             
            

var texts =[{na: "Go on", x: xBasis + xtextdis -10, y: yBasis + ytextdis},
           {na: "Schneller", x: (xBasis + xtextdis +  wBasis + dBasis),y: yBasis + ytextdis} ,
           {na: "Langsamer", x: (xBasis + 10+ 2 * (wBasis+ dBasis)),y: yBasis + ytextdis }];
        

            var bricks = [];
            for(var c=0; c<brickColumnCount; c++) {
            bricks[c] = [];
            for(var r=0; r<brickRowCount; r++) {
                bricks[c][r] = { x: 0, y: 0, status: 1 };
            }
            }

            var ground = new Image();
ground.src = "ground.jpg";
ctx.drawImage(ground,100,200);            
canvas.addEventListener('click', function(e)
     {       
        var rect = angetippt(rects, e.offsetX, e.offsetY);
        if (rect) 
        {
            auswahlButton();  
            //vergleich();         
        }}, false);

document.addEventListener("keydown", keyDownHandler, false);
document.addEventListener("keyup", keyUpHandler, false);
document.addEventListener("mousemove", mouseMoveHandler, false);


function keyDownHandler(e) {
    if(e.key == "Right" || e.key == "ArrowRight") {
        rightPressed = true;
    }
    else if(e.key == "Left" || e.key == "ArrowLeft") {
        leftPressed = true;
    }
}

function keyUpHandler(e) {
    if(e.key == "Right" || e.key == "ArrowRight") {
        rightPressed = false;
    }
        else if(e.key == "Left" || e.key == "ArrowLeft") {
            leftPressed = false;
        }
}

function mouseMoveHandler(e) {
  var relativeX = e.clientX - canvas.offsetLeft;
  if(relativeX > 0 && relativeX < canvas.width) {
    paddleX = relativeX - paddleWidth/2;
  }
}

function drawBall() {
    ctx.beginPath();
    ctx.arc(x, y, ballRadius, 0, Math.PI*2);
    ctx.fillStyle = "red";
    ctx.fill();
    ctx.closePath();
}

function drawPaddle() {
    ctx.beginPath();
    ctx.rect(paddleX, yUnten -paddleHeight, paddleWidth, paddleHeight);
    ctx.fillStyle = "Black";
    ctx.fill();
    ctx.closePath();
}

function drawBricks() {
    for(var c=0; c<brickColumnCount; c++) {
        for(var r=0; r<brickRowCount; r++) {
            if(bricks[c][r].status == 1) {
                var brickX = (c*(brickWidth+brickPadding))+brickOffsetLeft;
                var brickY = yOben -20 +(r*(brickHeight+brickPadding))+brickOffsetTop;
                bricks[c][r].x = brickX;
                bricks[c][r].y = brickY;
                ctx.beginPath();
                ctx.rect(brickX, brickY, brickWidth, brickHeight);
                ctx.fillStyle = "#0095DD";
                ctx.fill();
                ctx.closePath();
            }
        }
    }
}

function collisionDetection() {
    for(var c=0; c<brickColumnCount; c++) {
        for(var r=0; r<brickRowCount; r++) {
            var b = bricks[c][r];
            if(b.status == 1) {
                if(x > b.x && x < b.x+brickWidth && y > b.y && y < b.y+brickHeight) {
                    ySpeed = -ySpeed
                    b.status = 0;
                    score++;
                    if(score == brickRowCount*brickColumnCount) {
                        meldung(( "Spiel zu Ende"),"18px Arial","black",xBasis, yBasis - 40); 
                        clearInterval(myVar);
                        document.location.reload();
                       
                       
                       
                    } 
                }
            }
        }
    }
}

function drawScore() {
    ctx.font = "18px Arial";
    ctx.fillStyle = "black";
    ctx.fillText("Score: "+score, xBasis,yBasis - 60);
}

function drawLeben() {
   // meldung(( "Satz zu Ende"),"18px Arial","black",xBasis, yBasis - 40); ctx.font = "18px Arial";
    ctx.clearRect(xRechts-80,yBasis-60-20,300,20);
    ctx.fillStyle = "#0095DD";
    ctx.fillText("Leben: "+Leben, xRechts -80,yBasis -60);
}

// Spielaufbau   //
   meldung("Verbessere deine motorischen Fähigkeiten","20px Arial","black",50, 25);
   meldung("Schnelligkeit des Balls : " +  xSpeed ,"18px Arial","black",xBasis ,yBasis - 20);    
    ctx.strokeStyle = "black";
    ctx.rect(xBasis,yOben,xBreite,yHoehe);   
    ctx.stroke();
    buttonErstellen();
    buttonText();    
    drawBall();
    drawPaddle(); 
    drawBricks();
    drawScore();
    drawLeben();
    warten=0;

// Ende Spielaufbau    


function start(){
    
    stop=false;
    x = xBreite/2;
    y = yHoehe-30;
    
    meldung("Schnelligkeit des Balls   draw = " +  xSpeed ,"18px Arial","black",xBasis ,yBasis - 20);  
    myVar=setInterval(draw,35); 
}

function draw() {
    warten++;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    meldung("Verbessere deine motorischen Fähigkeiten","20px Arial","black",50, 25);     
    ctx.strokeStyle = "black";
    ctx.rect(xBasis,yOben,xBreite,yHoehe);   
    ctx.stroke();
    buttonErstellen();
    buttonText();    
    drawBall();
    drawPaddle(); 
    drawBricks();    
    collisionDetection();
    drawScore();
    drawLeben();

    
    if(x + xSpeed > xBasis+xBreite -ballRadius || x + xSpeed < xLinks +ballRadius) {
        xSpeed = -xSpeed;
    }
        if(y + ySpeed < yOben +ballRadius) {
            ySpeed = -ySpeed
        }

    else if(y + ySpeed > yUnten -ballRadius) {
        
        if(x > paddleX && x < paddleX + paddleWidth)
         {
            ySpeed = -ySpeed;          
        }
 
        else {
                Leben--;
                drawLeben();
               console.log( "  leben  " + Leben + " Speed    " + xSpeed + "  " +ySpeed);
                //  alert("hallo0" +Leben);

                if(!Leben) 
                {  
                         
                clearInterval(myVar);  
                document.location.reload();         
               // meldung(( "Raus aus aus dem Spiel"),"100px Arial","black",xBasis, yBasis - 40);
                  
                        
                }
                    else {  
                        x = xBreite/2;
                        y = yHoehe-30;
                        ySpeed = -ySpeed

                       // clearInterval(myVar);  
                    }
             }
        }

       
    if(rightPressed && paddleX < xRechts-paddleWidth) {
        paddleX += 7;
    }
    else if(leftPressed && paddleX > xLinks) {
        paddleX -= 7;
    }
    
   
    x += xSpeed;
    y += ySpeed
  console.log ("  x  " + x + "   y  " + y + " xspeed " + xSpeed + "   yspeed  " + ySpeed);
      
   
}



function buttonErstellen()
{
       for (var i = 0, len = rects.length; i < len; i++) {
        ctx.rect(rects[i].x, rects[i].y, rects[i].w, rects[i].h); 
        ctx.stroke();  
        ctx.fillStyle=rects[i].col;  
        ctx.fillRect(rects[i].x, rects[i].y, rects[i].w, rects[i].h);
        
      }
}

function buttonText()
{ 
    ctx.fillStyle = "black";
    ctx.font = "18px Arial";

    for (var i = 0, len = texts.length; i < len; i++) 
    {
       ctx.fillText(texts[i].na,texts[i].x, texts[i].y);
        
     }
        
}
function meldung(text, schrift,farbe,xm,ym)
   {
    var lg = 20 + ctx.measureText(text).width 
        ctx.clearRect(xm,ym,lg,-20);
        ctx.fillStyle = farbe;
        ctx.font = schrift;
        ctx.fillText(text, xm ,ym); 
    }

function angetippt(rects, x, y) {
    var zw;
    var isCollision = false;
    for (let i = 0, len = rects.length; i < len; i++) {
        var left = rects[i].x, right = rects[i].x+rects[i].w;
        var top = rects[i].y, bottom = rects[i].y+rects[i].h;
        if (right >= x
            && left <= x
            && bottom >= y
            && top <= y) {
                isCollision = rects[i];   
                getipptRechteck=i;        
          }
    }
    return isCollision;
}

function auswahlButton()
    {
        switch (getipptRechteck) 
                {
                    case 0:                                         
                        start();
                        break;                    
                    case 1:
                        plusMinus(schrittWeite);                           
                        break;
                    case 2:
                        plusMinus(-schrittWeite);                           
                        break;                                 
                    default:
                       alert("ups");
                }             
    }

function plusMinus(sw)

{
 xSpeed = xSpeed + sw ;
 ySpeed = ySpeed -sw;
 console.log(xSpeed + ySpeed);
 var lg = 20 + ctx.measureText("Schnelligkeit des Balls  plus minus  = " +  xSpeed + " milli Sek").width 
 
 meldung("Schnelligkeit des Balls  = " +  xSpeed  ,"18px Arial","black",xBasis ,yBasis - 20);
}


</script>

</body>
</html>