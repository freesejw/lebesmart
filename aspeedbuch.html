<!DOCTYPE html>
<html>
<head>
        <meta charset="utf-8">    
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<style>
canvas {
    
    border: 1px red solid;
     background-color: #FFEFDB;
   cursor: url(Images/fadenkreuz.png),  auto; 


}
</style>
</head>
<body onload="ladeGame()"></body>
<body >
    <canvas id = "findeZahl"></canvas>
<script>


var canv = document.getElementById("findeZahl");
var ctx = canv.getContext("2d");
canv.width=500;
canv.height=550;

var xAbstand=30,yAbstand = 70;     // Verschiebt die Matrix nach rechts und unten
var xDist=15, yDist=25;  // Verschiebt die Zahlen im Feld;
var xCoord = [],yCoord = [];  // x Koordinate links oben im Feld und y Koordinate links oben im Feld
var zahlenSpeicher= [];
var indexReihe = [];
var punkteGesamt = new Array();
var trefferListe = new Array();
var treffer;
var zeilenZahl = 7, spaltenZahl =7; // Felder pro Spalte und Zeile
var breite = 45, hoehe=45;
var anzahlFelder = zeilenZahl*spaltenZahl;
var xPos, yPos,xclick, yclick;;
var zaehlerClick, zaehlerTreffer,anzahlTreffer,durchLauf;
var rundeAus;
var blocken;
var bgColor="lightblue";

var zeitSchranke = 8; // max. Zeit zum finden der Buchstaben in Sekunden

var zeitAusgang; // Startwert für die Ermittlung der abgelaufenen Zeit;
var buchStaben=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];
//var buchStaben=[1,2,3,4,5,6,7,8,9,0,"a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];
var xBasis=20, yBasis=460, wBasis=120, hBasis=40, dBasis=40, xtestdis=20, ytextdis=25;

var rects = [{x: xBasis, y: yBasis, w: wBasis, h: hBasis,col: bgColor,te: "Start"},
             {x: (xBasis + wBasis+ dBasis), y: yBasis, w: wBasis, h: hBasis,col: bgColor,te:"Stop"},
             {x: (xBasis + 2 * (wBasis+ dBasis)), y: yBasis, w: wBasis, h: hBasis,col: bgColor, te: "Abbruch"}];


var texts =[{na: "Go on", x: xBasis + xtestdis -10, y: yBasis + ytextdis},
           {na: "Mehr Zeit", x: (xBasis + xtestdis -10+  wBasis + dBasis),y: yBasis + ytextdis} ,
           {na: "Weniger Zeit", x: ((xBasis + xtestdis-10) + 2 * (wBasis+ dBasis)),y: yBasis + ytextdis }];



function ladeGame(){
    meldung("Steigere deine Denk - Geschwindigkeit","20px Arial","black",xAbstand, 30); 
    meldung("Finde die Buchstaben","18px Arial","black",xAbstand, 60); 
    meldung("Suchzeit " +  zeitSchranke + " S.","20px Arial","black",xAbstand+20 + breite* spaltenZahl, 40+(3*yAbstand));
    ermittleBasisBuch(zeilenZahl,spaltenZahl);
    aufbauMatrix(zeilenZahl,spaltenZahl,breite,hoehe,zahlenSpeicher);
    buttonErstellen();
   buttonText();
   anzahlTreffer=0;
   durchLauf=0;
   
}


function start() { 
  
    ctx.clearRect(xAbstand,yAbstand,breite*spaltenZahl,hoehe*zeilenZahl);
    zaehlerClick=0;
    zaehlerTreffer=0; 
    zahlenSpeicher=[];
    indexReihe=[];
    durchLauf++;
    zeitAusgang=0;
    rundeAus=false;
    blocken=false;
    loescheText(30,420,300,-20);   
    ctx.clearRect(xAbstand+ breite* spaltenZahl, 80,400,100);  
    ermittleBasisBuch(zeilenZahl,spaltenZahl);
    aufbauMatrix(zeilenZahl,spaltenZahl,breite,hoehe,zahlenSpeicher);    
    auswahlZahlen(zeilenZahl,spaltenZahl);   
   
    id=setInterval(zeitPruef,1000);
        }

function zeitPruef()
   {
    // Misst die Zeit. Bricht bei Zeit�berschreitung den Vorgang ab
    // gesteuert wird das �ber width und die globale Variable timeForFind

    zeitAusgang=zeitAusgang + 1;
    //console.log("zeitAusgang " + zeitAusgang + "  schranke  "  + zeitSchranke );

    if(zeitAusgang >= zeitSchranke)  
        { 
            loescheText(30,400,300,-20);      
            dead.play();
            dead.play();
            meldung("Zeitlimit erreicht ==>  Go on" ,"bolder 18px Arial","red",30,420); 
            dead.play();
           
            clearInterval(id);
            blocken=true;
            }
    if (rundeAus)
        {
            clearInterval(id);
            blocken=true;
        }
}

canv.addEventListener('click', function(event) {   
if (blocken==false) { 
        xclick = event.clientX;
        yclick = event.clientY; 
        xclick = xclick - xAbstand ;
        yclick = yclick - yAbstand ;
        zaehlerClick++;
        if (xclick>=xPos){}   
        var treffer=false;    
        var zwert = feldNummerSchuss(xclick,yclick) // liefert den Index des getroffenen Feind/Freund/Umfeld 

        if (zwert>=0) { treffer= true}
            if ( treffer == true) 
            {
            
                var zw =indexReihe.indexOf(zwert);
            
                if (zw>=0)
                        {
                            zaehlerTreffer++;
                            xxclick=(Math.floor(xclick/breite))*breite;
                            yyclick=(Math.floor(yclick/hoehe))*hoehe;   
                        
                            
                            ctx.fillStyle="green";
                            ctx.font= "bolder 22px Arial";
                            ctx.fillText(zahlenSpeicher[indexReihe[zw]],xxclick +xAbstand + xDist,yyclick+yAbstand+yDist);
                           
                           
                            ctx.lineWidth="5";
                            ctx.strokeStyle="green";       
                            ctx.strokeRect(xxclick+xAbstand,yyclick+yAbstand,breite,hoehe);   
                            treffer=false;
                            
                            
                        }
                        else {
                            loescheText(30,420,200,-20);
                            meldung("Falsch. ==> Go on" ,"18px Arial","red",30,420);  
                            dead.play();

                            rundeAus=true ;
                            blocken=true;
                                            
                            }
            }
            if (zaehlerTreffer == indexReihe.length){
                loescheText(30,420,200,-20);  
                anzahlTreffer++;
                console.log(durchLauf);
                meldung("Treffer = : " + anzahlTreffer+" von  "+ durchLauf + "  Versuchen","18px Arial","black",30,420); 

                rundeAus=true;
                blocken=true;
            }
        }    
}, false); 

canv.addEventListener('click', function(e)
     {
       
        var rect = angetippt(rects, e.offsetX, e.offsetY);        
        if (rect) 
        {
            auswahlButton();           
        } 

    }, false);

function buttonErstellen()
{
       for (var i = 0, len = rects.length; i < len; i++) {
        ctx.rect(rects[i].x, rects[i].y, rects[i].w, rects[i].h); 
        ctx.stroke();     
        ctx.fillStyle=rects[i].col;  
        ctx.fillRect(rects[i].x, rects[i].y, rects[i].w, rects[i].h);
      }
}

function buttonText()
{ 
    ctx.fillStyle = "black";
    ctx.font = "18px Arial";

    for (var i = 0, len = texts.length; i < len; i++) 
    {
       ctx.fillText(texts[i].na,texts[i].x, texts[i].y);
        
     }
        
}

function angetippt(rects, x, y) {
    var zw;
    var isCollision = false;
    for (let i = 0, len = rects.length; i < len; i++) {
        var left = rects[i].x, right = rects[i].x+rects[i].w;
        var top = rects[i].y, bottom = rects[i].y+rects[i].h;
        if (right >= x
            && left <= x
            && bottom >= y
            && top <= y) {
                isCollision = rects[i];   
                getipptRechteck=i;
            
                }
    }
    return isCollision;
}

function auswahlButton()
    {
        switch (getipptRechteck) 
                {
                    case 0:                    
                        start();                       
                        break;
                    case 1:
                        erhoehLevel();                        
                        break;
                    case 2:
                        senkLevel();                        
                        break;
                    default:
                        alert("Sorry");
                }             
    }

function getroffen(){
    {
        xxclick=(Math.floor(xclick/breite))*breite;
        yyclick=(Math.floor(yclick/hoehe))*hoehe;   
        
        meldung(zahlenSpeicher[indexReihe[1]] ,"18px Arial","black",xxclick +xAbstand + xDist,yyclick+yAbstand+yDist);    
        treffer=false;
                }

}    


function aufbauMatrix(zeilen,spalten,breite,hoehe,zahlen)
{
   // legt eine Matrix an . In derren Elemente werden nachfolgend die ausgewählten Bilder gezeichnet
    for (let i = 0; i<zeilen; i++)
    {
        var y=hoehe*i;
        for(let j=0;j < spalten;j++)
        {            
            var x=breite*j;  
            ctx.lineWidth="1";
            ctx.strokeStyle="red";       
            ctx.rect(x+xAbstand,y+yAbstand,breite,hoehe);
            ctx.stroke();

            ctx.fillStyle="black";
            ctx.font= "20px Arial";

            var xx=zahlenSpeicher[i*spalten +j];            
            ctx.fillText(xx,x+xAbstand + xDist,y+yAbstand+yDist);

            
            //linke, obere Koordinaten der Rechtecke
            xCoord.push(x);
            yCoord.push(y);
           
           
        }
    }   
}

function ermittleBasisBuch(zeilen,spalten)
    {
        
    var abc;    
    for (let i = 0;i<zeilen*spalten;i++ ) 
            {

            abc= buchStaben[random(buchStaben.length-1)]; 
            console.log("    " + abc);
            zahlenSpeicher.push(abc);
            }
           // console.log ("  zahlenSpeicher ",zahlenSpeicher);

    }

    function ermittleBasisZahlen(zeilen,spalten)
    {
    for (let i = 0;i<zeilen*spalten;i++ )
            {
              
            zahlenSpeicher.push(random(10)-1);
            }
           // console.log ("  zahlenSpeicher ",zahlenSpeicher);

    }


function auswahlZahlen(zeilen,spalten){
 var laenge; 
 var zw=random(9);
 var anz = zeilen*spalten;
 var text1="Suche : "  ;
 var text2="";

// zw ermittelt die Anzahl der Buchstaben
if (zw < 1) {laenge=4;}
    else if (zw < 8) {laenge=3;}
    else {laenge=2; }

// finden StartIndex 
var startIndex=random((zeilen*spalten)-laenge);
var xz = Math.floor(startIndex/spalten);
var xs = startIndex - (xz*spalten)+1;
if (xs > (spalten - laenge) + 1){
    startIndex=(xz+1)*spalten - laenge;
}

// ermitteln der IndexReihe
for (i=0; i < laenge;i++){
indexReihe.push(startIndex + i);
text2= text2+zahlenSpeicher[indexReihe[i]];
} 

//console.log("  IndexReihe  " + indexReihe + " laenge "  + laenge + " Speicherzahl  " + zahlenSpeicher[indexReihe[1]]);
//console.log(zahlenSpeicher);
// zu findene Buchstaben ausweisen

    meldung(text1,"18px Arial","black",xAbstand+20 + breite* spaltenZahl, 2*yAbstand);  
    meldung(text2,"20px Arial","blue",xAbstand+2*20 + breite* spaltenZahl, 40+(2*yAbstand));   
} 

function feldNummerSchuss(xc,yc){    // xc und yc sind die Koordinaten des Klicks 
    // Liefert deie Nummer des Feldes wenn ein Treffer erfolgte. Dabei wird noch nicht nach Gruppe unterschieden
    var zw;
    for (var i=0;i<anzahlFelder;i++){

        if ((xCoord[i] < xc) && (xc < xCoord[i] + breite ) &&
            (yCoord[i] < yc) && (yc < yCoord[i]+ hoehe))
            {
            zw=i;      
           // console.log(i,  "  " + "xC[i]  " + xCoord[i]  +  "yd[i]  " + yCoord[i] );
        }
        else{
            //console.log(" i =  " ,i,  "   " + "xC[i]  " + xCoord[i]  + "yd[i]  " + yCoord[i]) ;   
            //console.log( "xc  " + xc + "  yc  " +  yc );
        } 
     }
    // console.log("  zw       "  + zw)
  return zw;  
}

 function random(max)
          {
            return Math.floor((Math.random() *max)+1);
          }

function loescheText(x,y,w,h){
    ctx.clearRect(x,y,w,h);
}

function meldung(text, schrift,farbe,xm,ym)
   {
     
        var lg = 30 + ctx.measureText(text).width 
        ctx.clearRect(xm,ym+25,lg,-25);
        
        ctx.fillStyle = farbe;
        ctx.font = schrift;
        ctx.fillText(text, xm ,ym); 
    }

      
function erhoehLevel(){
    zeitSchranke=zeitSchranke + 1;
    ctx.clearRect(xAbstand+ 20 + breite* spaltenZahl, -20 + 3*yAbstand,120,100); 
    meldung("Suchzeit " +  zeitSchranke + " S.","20px Arial","black",xAbstand+20 + breite* spaltenZahl, 40+(3*yAbstand)); 
}      
      
 function senkLevel(){
     zeitSchranke=zeitSchranke - 1;
     ctx.clearRect(xAbstand+ 20 + breite* spaltenZahl, -20 + 3*yAbstand,100,100); 
     meldung("Suchzeit " +  zeitSchranke + "S.","20px Arial","black",xAbstand+20 + breite* spaltenZahl, 40+(3*yAbstand)); 
 }

// load audio files

let dead = new Audio();
let eat = new Audio();
let up = new Audio();
let right = new Audio();
let left = new Audio();
let down = new Audio();
 
dead.src = "audio/dead.mp3";
eat.src = "audio/eat.mp3";
up.src = "audio/up.mp3";
right.src = "audio/right.mp3";
left.src = "audio/left.mp3";
down.src = "audio/down.mp3";


      </script>

<p>The red square is actually being drawn 50 times per second.</p>
</body>
</html>
