<!DOCTYPE html>
<html>
<head>
        <meta charset="utf-8">   
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<style>

Canvas {
   position: absolute;
   top: 0px;
   left: 0px;
   border: 1px red solid;
   background-color: #FFEFDB;
}
</style>
</head>
<body onload="ladeGame()">
    <canvas id="canvas" width="500" height="600"></canvas>
     
<script>
var farbe=["green", "blue", "red", "black", "gray"];
var farbNamen = ["Grün","Blau","Rot","Schwarz","Grau"]
var farbeSuch, farbNamenSuch;   
var indexFarbe=[]; 
var canv = document.getElementById("canvas");
var ctx = canv.getContext("2d");
var myVar; // für setInterval
var getipptRechteck; // gibt an welcher Button / Rechteck angetippt wurde
var blocken;
var reaktionsZeit=2;
var maxDurchlaeufe=3;

var durchLaeufe, treffer;
var bgColor="lightblue";
var vergleichIndex; // dient zur abfrage welcher Button / rechteck angeklickt wurdej
var audio;
var xBasis=20, yBasis1=200, wBasis1=60, hBasis=40, dBasis=40, xtestdis=20, ytextdis=25;
var yBasis2= 420, wBasis2=120, yErhoehung=50; 
//Rechtecke für die Farben
var rects = [{x: xBasis, y: yBasis1, w: wBasis1, h: hBasis,col: "gray"},
             {x: (xBasis + wBasis1+ dBasis), y: yBasis1, w: wBasis1, h: hBasis,col: "green"},
             {x: (xBasis + 2 * (wBasis1+ dBasis)), y: yBasis1, w: wBasis1, h: hBasis,col: "blue"},
             {x: (xBasis + 3 * (wBasis1+ dBasis)), y: yBasis1, w: wBasis1, h: hBasis,col: "red"},
             {x: (xBasis + 4 * (wBasis1+ dBasis)), y: yBasis1, w: wBasis1, h: hBasis,col: "black"},
 // Button fuer Go on usw.
             //  
             {x: xBasis, y: yBasis2, w: wBasis2, h: hBasis,col: bgColor},
             {x: (xBasis + wBasis2+ dBasis), y: yBasis2, w: wBasis2, h: hBasis,col: bgColor},
             {x: (xBasis + 2 * (wBasis2+ dBasis)), y: yBasis2, w: wBasis2, h: hBasis,col: bgColor},
             {x: (xBasis + 2 * (wBasis2+ dBasis)), y: yBasis2 + yErhoehung, w: wBasis2, h: hBasis,col: bgColor}];
 
var texts =[{na: "Go on", x: xBasis + xtestdis -10, y: yBasis2 + ytextdis},
           {na: "Abbruch", x: (xBasis + xtestdis +  wBasis2 + dBasis),y: yBasis2 + ytextdis} ,
           {na: "Mehr Zeit", x: (xBasis + xtestdis + 2 * (wBasis2+ dBasis)),y: yBasis2 + ytextdis },
           {na: "Weniger", x: (xBasis + xtestdis + 2 * (wBasis2+ dBasis)),y: yBasis2 + yErhoehung + ytextdis }];

var box =  {x:20, y: 240, w: 420,h: 80 };  //Textbox

function ladeGame() 
    {   
        meldung("Verbessere deine Reaktionszeit","20","Arial","black",80, 25);
        ctx.strokeRect( 80,60, 200, 40);  // Rechteck um "RED" Text
        meldung(" Red ? ","bolder 20", "Arial","blue",100, 88);
        meldung("Tippe die Farbe des angebotenen Wortes","18","Arial","black",80, 125);
        meldung("Hier im Beispiel wäre es Blau","18","Arial","black",80, 150);
        meldung("Reaktionszeit = " ,"18","Arial","blue",340 ,370);
        meldung(reaktionsZeit + " Sek.","18","Arial","blue",340 ,400);
        erzeugeButton(0,rects.length); // Rechtecke / Button werden hier gezeichnet 
        buttonText();  // und hier mit Text versehen falls keine Farbe genommen wird 
        blocken=false;
    }

    canv.addEventListener('click', function(e)
     {
       
        var rect = angetippt(rects, e.offsetX, e.offsetY);
        
        if (rect)
            {           
                auswahlButton();            
                if ( (vergleichIndex==farbeSuch) && ( getipptRechteck<farbe.length))
                    { treffer++; 
                    meldung( treffer + " Treffer  bei " + durchLaeufe + " Durchläufe","18" ,"Arial","blue",xBasis, 300);
                    }  
            }   
        }, false);

function start()

    {
        durchLaeufe=0;
        blocken = true;
        treffer=0;   
        ctx.strokeRect( 80,60, 200, 40);
        meldung("                                          ","18","Arial","black",80, 150);   // löscht "" Hier im Beispiel wäre es Blau"
        ctx.clearRect(100,88-20, 180, 25); // Löscht den Text der anzutippenden Farbe       
        ctx.clearRect(xBasis,300-20,300, 20); // löscht : .. Treffer bei ... Durchläufe
        indexFarbe=auswahlIndex(); // Die farbe der Farb rechtecke werden bei jedem start aufruf geändert
        for (var i = 0 ; i < indexFarbe.length;i++)
         {  
            ctx.strokeRect(rects[i].x, rects[i].y, rects[i].w, rects[i].h);           
            rects[i].col=farbe[indexFarbe[i]];     
            ctx.fillStyle=rects[i].col;          
            ctx.fillRect(rects[i].x, rects[i].y, rects[i].w, rects[i].h);
         }
         farbeSuch=999;
        myVar = setInterval(folgeFarbe, reaktionsZeit*1000);        
    }

function folgeFarbe()
    {    
       
        var farbeSuchAlt=farbeSuch;

        if(durchLaeufe <maxDurchlaeufe)
            {
                durchLaeufe++;
                do
                {
                    farbeSuch=random(farbe.length);// Index der Farbe in der das Wort angeboten wird            
                }
                while(farbeSuchAlt===farbeSuch);    
           
            farbNamenSuch=random(farbNamen.length); // Index des Namens der Farbe
            ctx.strokeStyle="red";
            ctx.strokeRect(80,60,200,40);
            ctx.clearRect(80,60, 200, 40);// löscht den Farbnamen im Textfeld
            meldung(farbNamen[farbNamenSuch],"bolder 22","Arial",farbe[farbeSuch],100, 88);   
            }
        else
            {              
            clearInterval(myVar);
            akustischeMeldung("audio/up.mp3"); 
            blocken=false;
            abbruch();
            }
    }

function auswahlIndex()
    {
    //Bestimmt per Zufall die Farbenfolge 
    var zww=[];
        for (var i =0; i<farbe.length;i++)
        {
        var zw =(random(farbe.length));    
        if (zww.indexOf(zw) <0)
            {           
                zww.push(zw);            
            }
         else
            {i=i-1;}        
        } 
    return zww;
    }

function abbruch()
// Wenn Basisfarbe mit dem geklickten farbe indentisch ist Treffermeldung und Abbruch
    {
    var quote=(treffer)/(durchLaeufe-1);
    quote=Math.round(quote*100);
    meldung( treffer + " Treffer  bei " + durchLaeufe + " Durchläufe","18" ,"Arial","blue",xBasis, 300);        
     //meldung("Deine Trefferquote war " + quote + " Prozent","18","Arial","blue",80,350);
          
   //  console.log("durchLaeufe  " + durchLaeufe + " treffer  " + treffer);
        clearInterval(myVar);   
    }
 


function auswahlButton()
    {
        
        switch (getipptRechteck) 
        
        {
                    case 0:                    
                    case 1:
                    case 2:
                    case 3:
                    case 4:
                    vergleichIndex=indexFarbe[getipptRechteck]; 
                    break;   
                    case 5:
                        if (blocken ==false){start();} 
                        break;                            
                    case 6:
                        abbruch();                        
                        break;
                    case 7:
                    if (blocken ==false){reaktionsZeit =plusMinus(reaktionsZeit,0.25,0.5, 10);}
                    meldung("Reaktionszeit = " ,"18","Arial","blue",340 ,370);
                    meldung(reaktionsZeit + " Sek.","18","Arial","blue",340 ,400);                                     
                    break;
                    case 8:
                    if (blocken ==false){reaktionsZeit=plusMinus(reaktionsZeit,-0.25,0.5, 10);}
                     meldung("Reaktionszeit = " ,"18","Arial","blue",340 ,370);
                     meldung(reaktionsZeit + " Sek.","18","Arial","blue",340 ,400);                                   
                    break;  
                    default:
                    alert("Sorry");
                }             
    }

function random(max)
          {
            return Math.floor((Math.random() *max));
          }

function angetippt(rects, x, y) {
    var zw;
    var isCollision = false;
    for (let i = 0, len = rects.length; i < len; i++) {
        var left = rects[i].x, right = rects[i].x+rects[i].w;
        var top = rects[i].y, bottom = rects[i].y+rects[i].h;
        if (right >= x
            && left <= x
            && bottom >= y
            && top <= y) {
                isCollision = rects[i];   
                getipptRechteck=i;
            
                }
    }
    return isCollision;
}

function erzeugeButton(a,b)
{
       for (var i = a;i < b; i++) {
        ctx.strokeStyle="red";   
        ctx.strokeRect(rects[i].x, rects[i].y, rects[i].w, rects[i].h);               
        ctx.fillStyle=rects[i].col;         
        ctx.fillRect(rects[i].x, rects[i].y, rects[i].w, rects[i].h);
      }
}

function buttonText()
 { 
        ctx.fillStyle = "black";
        ctx.font = "18px Arial";
        for (var i =0, len = 4; i < len; i++) 
        {      
        ctx.fillText(texts[i].na,texts[i].x, texts[i].y);           
        }
   }

function meldung(text, schriftGroesse,schriftTyp,farbe,xm,ym)
   {
        var lg = 20 + ctx.measureText(text).width 
        ctx.clearRect(xm, ym-schriftGroesse+2,lg,schriftGroesse);
        ctx.fillStyle = farbe;        
        ctx.font = schriftGroesse + "px "+ schriftTyp;
        ctx.fillText(text, xm ,ym); 
    }

function plusMinus(ausgang,delta,unten,oben)
{
        // Mehr oder weniger Zeit zum Suchen
        let anz=ausgang; 
        if ((anz + delta)< oben && delta>0)
        {anz=anz + delta; }
        if ((anz + delta)> unten && delta<=0)
        {anz=anz + delta; }
        
        return anz;
}   

function akustischeMeldung(a)
    {
        audio = new Audio(a);
        audio.play();
    }
</script>
  
<p>Enjoy !</p>

</body>
</html>
