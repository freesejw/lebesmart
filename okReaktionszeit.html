<!DOCTYPE html>
<html>
<head>
        <meta charset="utf-8">     
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<style>

Canvas {
   position: absolute;
   top: 0px;
   left: 0px;
  
   background-color: #FeFeFe;
}
</style>
</head>
<body onload="ladeGame()">
    <canvas id="canvas" width="500" height="400"></canvas>
     
<script>
var canv = document.getElementById("canvas");
var ctx = canv.getContext("2d");
var startTime, elapsedTime ;
var uebungStart=false;
var myVar, ident, aktIndex;
var anzahlBilder=12;
var pic =new Array;
var getipptRechteck;
var startIndex;
var geschwindigkeit=1000;
var zeiten=new Array;
var fehler=0;
var bgCol="Lavender";
var vgCol="#8800ff";
var elapsedTime;
var warten;
var audio;
var noClickStop;

var xBasis=20, yBasis=340, wBasis=120, hBasis=40, dBasis=40, xtestdis=20, ytextdis=25;

var rects = [{x: xBasis, y: yBasis, w: wBasis, h: hBasis,col1: "#82CE86",col2:"#82CE86"},
             {x: (xBasis + wBasis+ dBasis), y: yBasis, w: wBasis, h: hBasis,col1: "#ea2867",col2: "ea2867"},
             {x: (xBasis + 2 * (wBasis+ dBasis)), y: yBasis, w: wBasis, h: hBasis,col1: "#7f7fff",col2: "#7f7fff"}];

var bild = {x:200, y: 60, w: 100,h: 100 };

var texts =[{na: String.fromCharCode(9655)+  "  Go on", x: xBasis + xtestdis -10, y: yBasis + ytextdis},
           {na:  String.fromCharCode(9633)+ "  Stop", x: (xBasis + xtestdis +  wBasis + dBasis),y: yBasis + ytextdis} ,
           {na:  String.fromCharCode(9660)+ "  Abbruch", x: (xBasis + xtestdis + 2 * (wBasis+ dBasis)),y: yBasis + ytextdis }];
    
var box =  {x:20, y: 240, w: 420,h: 80 };  //Textbox

// Die bilder befinden sich im Ordner imageVerkehr

function ladeGame() 
    {   
        meldung("Minimiere die Reaktionszeit / Ã¼be die Konzentration","bold","20","Arial","#5a617b",10, 25);    
        einlesenBilder();
       zeigBild("imageverkehr/auge.gif");
       roundedButton();        
        buttonText();  // Start ; Stop ; Abbruch         
        noClickStop=true; 
    }

function start()
    {   
        ctx.clearRect(200, 190, 250, -60);
        ctx.clearRect(box.x -5,box.y-5,box.w+10,box.h+10)
        setzeAmpel("rot");          
        startIndex=random(anzahlBilder);    
        zeigBild(pic[startIndex]); // Basisbild. Mit dem werden die folgenden Bilder auf Gleichheit vergleiechen

        warten=0;
        myVar = setInterval(folgeBilder, 1000); 
           
    }



    canv.addEventListener('click', function(e)
     {
       
        var rect = angetippt(rects, e.offsetX, e.offsetY);
        if (rect) 
        {
            auswahlButton();           
        } 

    }, false);



function folgeBilder()
    {
       warten++;
       if (warten > 2)
       {
            if (warten==3)
            {   
                setzeAmpel("gruen"); 
                akustischeMeldung("audio/schuss.mp3"); 
                noClickStop=false;
            }
        aktIndex=random(anzahlBilder); // 
        zeigBild(pic[aktIndex])  ; // aktuelle Bilder. Sie werden mit Basisbild verglichen
        startTime = Date.now(); 
       }   
    }

function stop()
    // Wenn Basisbild mit dem geklickten Bild indentisch ist Treffermeldung und Abbruch
    {
    
     uebungStart=true;
     setzeAmpel("rot");
    if (aktIndex==startIndex)
        {
            elapsedTime = Date.now() - startTime;
            elapsedTime = (elapsedTime / 1000).toFixed(2);       
            zeiten.push(elapsedTime)
            boxMeldung(box.x,box.y,box.w,box.h,elapsedTime);     
        }
        else
            {            
            meldung("Falsches Zeichen getippt","normal","16","Arial","red",200, 180);
            fehler++;
            }

        zeigBild("imageverkehr/auge.gif");
        noClickStop=true;
        clearInterval(myVar);   
    }
 
function einlesenBilder()
     // wird beim Spielinitialisierung ladeGame aufgrufen 
    {
        for (i=0;i<= anzahlBilder;i++)
        {
            pic[i]=  "imageverkehr/verk" + i + ".jpg" ;
        } 
    }

function zeigBild(a)
{
    var img = new Image();
    img.onload = function ()
     {        
        
        ctx.drawImage(img, bild.x ,bild.y,bild.w,bild.h);
     }
    img.src = a;
}

function setzeAmpel(a)
{
    var img = new Image();
    img.onload = function ()
     {
        ctx.drawImage(img, 90 ,75,40,90);
     }
    img.src = ("imageverkehr/ampel" + a + ".jpg");
}

function random(max)
          {
            return Math.floor((Math.random() *max));
          }

function angetippt(rects, x, y) {
    var zw;
    var isCollision = false;
    for (let i = 0, len = rects.length; i < len; i++) {
        var left = rects[i].x, right = rects[i].x+rects[i].w;
        var top = rects[i].y, bottom = rects[i].y+rects[i].h;
        if (right >= x
            && left <= x
            && bottom >= y
            && top <= y) {
                isCollision = rects[i];   
                getipptRechteck=i;
            
                }
    }
    return isCollision;
}

function roundedButton()
{
       for (var i = 0, len = rects.length; i < len; i++) {       
       ctx.fillStyle=rects[i].col1;
       roundedRect(rects[i].x, rects[i].y, rects[i].w, rects[i].h,10);
            
      }
}

function buttonText()
{ 
    ctx.fillStyle = "white";
    ctx.font = "18px Arial";
    for (var i = 0, len = texts.length; i < len; i++) 
    {
       ctx.fillText(texts[i].na,texts[i].x, texts[i].y);
        
     }
     
}

function auswahlButton()
    {
        switch (getipptRechteck) 
                {
                    case 0:                    
                        start();             6         
                        break;
                    case 1:
                    if(noClickStop==false){
                        stop(); }                       
                        break;
                    case 2:
                        abbruch();                        
                        break;
                    default:
                        alert("Sorry");
                }             
    }

function abbruch()
    {
        setzeAmpel("rot");    
        clearInterval(myVar);
        zeigBild("imageverkehr/auge.gif");
    }

    function meldung(text,schriftDicke,schriftGroesse,schriftTyp,farbe,xm,ym)
   {
     
       var sD=schriftDicke;
       var sG=schriftGroesse;
        var lg = 10 + ctx.measureText(text).width 
       ctx.clearRect(xm, ym-schriftGroesse+2,lg,25);
        ctx.fillStyle = farbe;        
        ctx.font = sD + ' ' + (sG + "px "+ schriftTyp);              
        ctx.fillText(text, xm ,ym); 
    }

function boxMeldung(x,y,w,h,time)
    {
        ctx.rect(x, y, w,h);
        ctx.stroke();
        meldung(("gebrauchte Zeit (Sek.) : "  + time),"bold","16","Arial","#5a617b",x+10,y+h*0.33 );
        meldung(("Vergleich:  "  + zeiten),"normal","16","Arial","#5a617b", x + 10, y+ h*0.66 );
    }

function akustischeMeldung(a)
    {
        audio = new Audio(a);
        audio.play();
    } 
 function roundedRect(x, y, width, height, radius) {
        ctx.beginPath();
        ctx.moveTo(x, y + radius);
        ctx.lineTo(x, y + height - radius);
        ctx.arcTo(x, y + height, x + radius, y + height, radius);
        ctx.lineTo(x + width - radius, y + height);
        ctx.arcTo(x + width, y + height, x + width, y + height-radius, radius);
        ctx.lineTo(x + width, y + radius);
        ctx.arcTo(x + width, y, x + width - radius, y, radius);
        ctx.lineTo(x + radius, y);
        ctx.arcTo(x, y, x, y + radius, radius);
        ctx.lineWidth = 1;
        ctx.stroke(); 
        ctx.fill();
}  

</script>
  


</body>
</html>
