<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">     
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<link href='https://fonts.googleapis.com/css?family=Comfortaa' rel='stylesheet'>
<link href="css/standard.css" rel="stylesheet">
<script src="js/standard.js"></script>

<style></style>
</head>
<body onload="ladeGame()">
    <canvas id="canvas" width="500" height="400"></canvas>
     
<script>
var canv = document.getElementById("canvas");
var ctx = canv.getContext("2d");
var startTime, elapsedTime ;

var myVar, ident, aktIndex;
var anzahlBilder=12;
var pic =new Array;
var getipptRechteck;
var startIndex;
var geschwindigkeit=1000;
var zeiten=new Array;
var fehler=0;

var elapsedTime;
var warten, merkZeit=3;
var audio;
var noClickStop;

var xBasis=20, yBasis=340, wBasis=120, hBasis=40, dBasis=40, xtestdis=20, ytextdis=25;

var rects = [{x: xBasis, y: yBasis, w: wBasis, h: hBasis,col1: "#82CE86",col2:"#82CE86"},
             {x: (xBasis + wBasis+ dBasis), y: yBasis, w: wBasis, h: hBasis,col1: "#ea2867",col2: "ea2867"},
             {x: (xBasis + 2 * (wBasis+ dBasis)), y: yBasis, w: wBasis, h: hBasis,col1: "#7f7fff",col2: "#7f7fff"}];

var bild = {x:200, y: 60, w: 100,h: 100 };

var texts =[{na: String.fromCharCode(9655)+  "  Go on", x: xBasis + xtestdis -10, y: yBasis + ytextdis},
           {na:  String.fromCharCode(9633)+ "   Stop", x: (xBasis + xtestdis +  wBasis + dBasis),y: yBasis + ytextdis} ,
           {na:  String.fromCharCode(9660)+ "Abbruch", x: (xBasis + xtestdis + 2 * (wBasis+ dBasis)),y: yBasis + ytextdis }];
    
var box =  {x:20, y: 240, w: 420,h: 80 };  //Textbox

// Die bilder befinden sich im Ordner imageVerkehr

function ladeGame() 
    {   
        meldung("Minimiere die Reaktionszeit / Ã¼be die Konzentration","bold","20",schriftArt,"#5a617b",10, 25);    
        einlesenBilder();
        zeigBild("Imageverkehr/auge.gif",bild.x ,bild.y,bild.w,bild.h);
        roundedButton(3);        
        buttonText();  // Start ; Stop ; Abbruch         
        noClickStop=true; 
        noClickStart=false;
    }

function start()
    {   
        ctx.clearRect(20, 190, 450, 150);
        ctx.clearRect(box.x -5,box.y-5,box.w+10,box.h+10)
        setzeAmpel("rot");
        noClickStart=true; 
        noClickStop=true; // wird auf false gesetzt sobald die Vergleichsbilder gezeigt wurden         
        startIndex=random(anzahlBilder);    
        zeigBild(pic[startIndex],bild.x ,bild.y,bild.w,bild.h); // Basisbild. Mit dem werden die folgenden Bilder auf Gleichheit vergleiechen
        startTimer(50, 200, 400, 20, merkZeit*1000);  
        warten=0;
        myVar = setInterval(folgeBilder, geschwindigkeit); 
             
    }

    canv.addEventListener('click', function(e)
     {
       
        var rect = angetippt(rects, e.offsetX, e.offsetY);
        if (rect) 
        {
            auswahlButton();           
        } 

    }, false);



function folgeBilder()
    {
       warten++;
       if (warten > 2)
       {
            if (warten==merkZeit)
            {   
                setzeAmpel("gruen"); 
                akustischeMeldung("audio/schuss.mp3"); 
                noClickStop=false;
            }
        aktIndex=random(anzahlBilder); // 
        zeigBild(pic[aktIndex],bild.x ,bild.y,bild.w,bild.h)  ; // aktuelle Bilder. Sie werden mit Basisbild verglichen
        startTime = Date.now(); 
       }   
    }

function stop()
    // Wenn Basisbild mit dem geklickten Bild indentisch ist Treffermeldung und Abbruch
    {
    
     
     setzeAmpel("rot");
    if (aktIndex==startIndex)
        {
            elapsedTime = Date.now() - startTime;
            //elapsedTime = (elapsedTime ).toFixed(2);   
            elapsedTime = (elapsedTime );       
            zeiten.push(elapsedTime)
            boxMeldung(box.x,box.y,box.w,box.h,elapsedTime);     
        }
        else
            {            
            meldung("Falsch. Auf ein Neues!","normal","16",schriftArt,"red",20, 300);           
            zeigBild("bergsteiger.png",250,200,100,100);
            zeigBild("bergsteigersp.png",350,200,100,100);           
            }

        
        zeigBild("imageverkehr/auge.gif",bild.x ,bild.y,bild.w,bild.h) ;
        noClickStop=true;
        clearInterval(myVar); 
        setTimeout(function () 
                        {
                           start();
                        }, 3000); 
          
    }
 
function einlesenBilder()
     // wird beim Spielinitialisierung ladeGame aufgrufen 
    {
        for (i=0;i<= anzahlBilder;i++)
        {
            pic[i]=  "imageverkehr/verk" + i + ".jpg" ;
        } 
    }


function setzeAmpel(a)
{
    var img = new Image();
    img.onload = function ()
     {
        ctx.drawImage(img, 90 ,75,40,90);
     }
    img.src = ("imageverkehr/ampel" + a + ".jpg");
}


function auswahlButton()
    {
        switch (getipptRechteck) 
                {
                    case 0: if(noClickStart===false)
                      {                 
                        start();
                      }        
                        break;
                    case 1:
                    if(noClickStop==false)
                      {
                        stop(); 
                      }                       
                        break;
                    case 2:
                        abbruch();                        
                        break;
                    default:
                        alert("Sorry");
                }             
    }

function abbruch()
    {
        setzeAmpel("rot");    
        clearInterval(myVar);
        zeigBild("imageverkehr/auge.gif",bild.x ,bild.y,bild.w,bild.h);   
        noClickStart=false;
        noClickStop=true;
        meldung(("Gebrauchte Zeiten:  "  + zeiten),"normal","16",schriftArt,"#5a617b",29,300);
    }

function boxMeldung(x,y,w,h,time)
    {
        ctx.rect(x, y, w,h);
        ctx.stroke();
        meldung(("gebrauchte Zeit (ms) : "  + time),"bold","16",schriftArt,"#5a617b",x+10,y+h*0.33 );
       // meldung(("Vergleich:  "  + zeiten),"normal","16",schriftArt,"#5a617b", x + 10, y+ h*0.66 );
    }

function akustischeMeldung(a)
    {
        audio = new Audio(a);
        audio.play();
    } 
 

</script>
  


</body>
</html>
