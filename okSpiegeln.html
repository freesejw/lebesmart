<!DOCTYPE html>
<html>
<head>
        <meta charset="utf-8">     
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<link href='https://fonts.googleapis.com/css?family=Comfortaa' rel='stylesheet'>
<link href="css/standard.css" rel="stylesheet">
<script src="js/standard.js"></script>

<style></style>
</head>
<body onload="ladeGame()">
    <canvas id="canvas" width="500" height="600"></canvas>
     
<script>
var canv = document.getElementById("canvas");
var ctx = canv.getContext("2d");
var cW = ctx.canvas.width, cH = ctx.canvas.height;  

var xx=0,yy=100;
var indexBilder=[]; 
var getipptRechteck; // gibt an welcher Button / Rechteck angetippt wurde
var zeigen=4;
var durchLaeufe, treffer;
var bgCol="Lavender";
var vgCol="#8800ff";
var anzahlBilder=14, pic =new Array, zeigBilder=4;
var startTime,elapsedTime,zeiten=[];
var spiegel;
var clEvent=false;
var audio;


var yBasis0=150;
var yBasis1=230;
var yBasis2=350;
var yBasis3=550;

var xBasis=20, wBasis1=100, hBasis=140, dBasis=20, xtestdis=20, ytextdis=25;

var wBasis2=120, yErhoehung=50; 



//Rechtecke für die Bilder
var rects = [{x: (xBasis + 0 * (wBasis1 + dBasis)), y: yBasis0, w: wBasis1, h: hBasis},
             {x: (xBasis + 1 * (wBasis1 + dBasis)), y: yBasis0, w: wBasis1, h: hBasis},
             {x: (xBasis + 2 * (wBasis1 + dBasis)), y: yBasis0, w: wBasis1, h: hBasis},
             {x: (xBasis + 3 * (wBasis1 + dBasis)), y: yBasis0, w: wBasis1, h: hBasis},
          
 
             {x: xBasis, y: yBasis3, w: wBasis2, h: hBasis-100,col1: "82CE86",col2: "#82CE86"}];
           
          
var texts =[{na:  String.fromCharCode(9655)+ "  Go on", x: xBasis + xtestdis -10, y: yBasis3 + ytextdis}];

function ladeGame() 
    {   
        meldung("Übe dich in Konzentration","bold","20",schriftArt,"#5a617b",120, 50);     
        meldung("Welches Bild ist gespiegelt ? KLICK es an","normal","18",schriftArt,"#5a617b",xBasis, 360);  
        meldung("Dies ist ein Beispiel !!!! Starte mit Go on","bold","24",schriftArt,"red",xBasis,120);     
        erstelleBasisBild();  // dient nur zur Ansicht        
        treffer=0;
        durchLaeufe=0;
        
   
    }

    function Goon(){
        ctx.clearRect(xBasis,120-24,480,30);// löscht " dies ist ein ...."
        ctx.clearRect(xBasis,490-24,490,30);//
        //ctx.clearRect(xBasis,490-24,480,30);//
        erstelleBasisBild()
        startTime = Date.now(); 
        clEvent=true;
        durchLaeufe++;
    }

    function erstelleBasisBild()
    {
        erzeugeDieRechtecke(0,4); // Rexhteck(4) ist der Go on Button
        rechteckeText();  // und hier wird der Go on Button mit Text versehen  
        einlesenBilder();
        indexBilder=(random(pic.length));              
        zeichneVorgabeBilder();
         
         
    }
    
  
canv.addEventListener('click', function(e)
     {
        var rect = angetippt(rects, e.offsetX, e.offsetY);   
       
        if (rect)
        {          
           if (clEvent==true){
clEvent=false;
            if ( (getipptRechteck==spiegel)) //&& ( getipptRechteck<indexBilder.length)&&blocke==false)
                { treffer++;
                blocke= true; 
                meldung("Treffer : " + treffer + "  Durchläufe " + durchLaeufe,"bold","16",schriftArt,"red",xBasis,490);   
                elapsedTime = Date.now() - startTime;
                elapsedTime = Math.round(elapsedTime / 100);       
                zeiten.push(elapsedTime)           
                meldung(( "Gebrauchte Zeiten(in ds) :  " + zeiten),"normal","16",schriftArt,"#5a617b",xBasis, yBasis2+ytextdis+155);        
                }
                else{
                   ctx.clearRect(xBasis,490-24,490,30);// 
                   meldung("Falsch   ==> Go on","normal","18",schriftArt,"red",xBasis,490)
                   akustischeMeldung("audio/up.mp3");  
                }
           }
            if ( (getipptRechteck==zeigen)) // Zeigen istr die Nummer des Buttons Go on
                {
                Goon();
                }
        }
        }, false);





function erzeugeDieRechtecke(a,b)
{
       for (var i = a;i <= b; i++) {
        ctx.rect(rects[i].x, rects[i].y, rects[i].w, rects[i].h); 
        ctx.stroke();          
        ctx.fillStyle=rects[i].col2;         
       ctx.fillRect(rects[i].x, rects[i].y, rects[i].w, rects[i].h);
      }
}



function zeichneVorgabeBilder(){
    spiegel=random(4);
    for (var i=0;i<zeigBilder;i++)
    { 
        zeigBild(pic[indexBilder], rects[i].x, rects[i].y, rects[i].w, rects[i].h,spiegel,i);     
    } 
}

function zeigBild(a,x,y,w,h,sp,i)
{
    console.log("index  " + indexBilder + "  i  " + i);
    var img = new Image();
    img.onload = function ()
     {
        
        if(i===sp) {
            console.log("sp " +sp);
            ctx.scale(-1,1)
            //ctx.drawImage(img,x,-1*(y+h),w,h);
            ctx.drawImage(img,-1*(x+w),y,w,h);
            ctx.restore();
            ctx.scale(-1,1);
        }
        else
            ctx.drawImage(img, x,y,w,h);
     }
    img.src = a;
}

function rechteckeText()
{ 
    ctx.fillStyle = "white";
    ctx.font = "18px Arial";
    
       ctx.fillText(texts[0].na,xBasis + xtestdis -10, yBasis3 + ytextdis);
        
  
}


function einlesenBilder()
    {
        for (i=0;i< anzahlBilder;i++)
        {
            pic[i]=  "Spiegeln/sp" + i + ".jpg" 
        } 
    };

function shuffle(a) {
    for (let i = a.length - 1; i > 0; i--) 
    {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
}

</script>
  


</body>
</html>
