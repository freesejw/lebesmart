<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">   
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<link href='https://fonts.googleapis.com/css?family=Comfortaa' rel='stylesheet'>
<link href="css/standard.css" rel="stylesheet">
<script src="js/standard.js"></script>

<style></style>
</head>
<body onload="ladeGame()"></body>
<body >
    <canvas id = "StrukturFinden"></canvas>
<script>


var canv = document.getElementById("StrukturFinden");
var ctx = canv.getContext("2d");
canv.width=500;
canv.height=500;

var xAbstand=60,yAbstand = 110;     // Verschiebt die Matrix nach rechts und unten
var xDist=15, yDist=25;  // Verschiebt die Zahlen im Feld;
var xCoord = []; yCoord = [];   // x y Koordinate links oben im Feld
var audio;
var indexReihe = [];// hier werden die indizes der Felder gespeichert die angezeigt werden sollen
var plusPunkte = 0,minusPunkte=0;
var zeilenZahl = 5, spaltenZahl = 5; // Felder pro Spalte und Zeile
var breite = 50, hoehe=50;

var xPos, yPos,xclick, yclick;
var zaehlerClick, zaehlerTreffer;
var blocken;

var anzahlBilder = 3,zeitSchranke = 4;// Anzahl Bilder und max. Zeit zum finden der Zahl in Sekunden
var zeitAusgang; // Startwert für die Ermittlung der abgelaufenen Zeit;

var xBasis=20, yBasis=440, wBasis=120, hBasis=40, dBasis=40, xtestdis=20, ytextdis=25;

var rects = [{x: xBasis, y: yBasis, w: wBasis, h: hBasis,col1: "#82CE86",col2:"#82CE86"},
             {x: (xBasis + wBasis+ dBasis), y: yBasis, w: wBasis, h: hBasis,col1: "#5a617b",col2: "#5a617b"},
             {x: (xBasis + 2 * (wBasis+ dBasis)), y: yBasis, w: wBasis, h: hBasis,col1: "#5a617b",col2: "#5a617b"}];

var texts =[{na:String.fromCharCode(9655) + "   Go on", x: xBasis + xtestdis -10, y: yBasis + ytextdis},
           {na: String.fromCharCode(43)+ "   Bilder", x: (xBasis + xtestdis +5+  (wBasis + dBasis)-10),y: yBasis + ytextdis} ,
           {na: String.fromCharCode(45) + "   Bilder", x: ((xBasis + xtestdis +5) + 2 * (wBasis+ dBasis)) - 10,y: yBasis + ytextdis }];

function ladeGame()
{
    meldung("Erhöhe die Denkgeschwindigkeit + Merkspanne","bold","20",schriftArt,"#5a617b",xBasis, 30); 
    meldung("Merke Dir die Bildpositionen ; Merkzeit 4 Sek.","normal","16", schriftArt,"#5a617b",xBasis, 60);   
    meldung("Anzahl Bilder = " +  anzahlBilder,"normal","16",schriftArt,"#5a617b",260,420);
    meldung("Punkte gesamt = " + plusPunkte ,"bold","16",schriftArt,"#5a617b",335,260);  
    meldung("Durchgänge : " + (plusPunkte+minusPunkte)  ,"normal","16",schriftArt,"#5a617b",335,300);  
    aufbauMatrix(zeilenZahl,spaltenZahl,breite,hoehe);
    roundedButton(3);
    buttonText();     
    blocken=false; 
}

function start() 
{ 
    blocken=true; // Klicken weährend dedr Merkphase verhindern
    ctx.clearRect(xAbstand,yAbstand,breite*spaltenZahl,hoehe*zeilenZahl);//Löscht die Matrix 
    //ctx.clearRect(xBasis,220-40,350,40);//löscht text " falsches Feld..."
    zaehlerClick=0;
    zaehlerTreffer=0;     
    indexReihe=[]; 
    zeitAusgang=0; //  
    aufbauMatrix(zeilenZahl,spaltenZahl,breite,hoehe);    
    auswahlZellen(zeilenZahl,spaltenZahl);   // wählt die felder aus die gesucht werden sollen und zeigt sie an 
   // meldung("Zeit zum Merken :  " + (zeitSchranke - zeitAusgang) + " Sek. Zeit" ,"normal","16",schriftArt,"#5a617b",xBasis,395); 
   startTimer(xAbstand, 395-25, 250, 20, 4000.,"Merken","16px Arial"); 
   //startTimer(xAbstand, 380, 250,20, 4*1000);   
    //progMinus(xAbstand,395,250,16,4,100);
   id=setInterval(zeitAbfrage,1000);
}

function zeitAbfrage()
   {
        // Misst die Zeit.     
        //meldung("Zeit zum Merken :  " + (zeitSchranke - zeitAusgang) + " Sek. Zeit" ,"normal","16",schriftArt,"#5a617b",xBasis,395); 
        zeitAusgang=zeitAusgang + 1;   
        if(zeitAusgang >= zeitSchranke)  
            { 
                blocken=false;
                ctx.clearRect(xAbstand,395 - 25,400,25);   // Merke dir die Position....
                meldung("Jetzt suche die Bilder" ,"normal","16",schriftArt,"red",xAbstand,395); 
                for (var i =0; i<anzahlBilder;i++)
                {
                    ctx.clearRect(xCoord[indexReihe[i]] + xAbstand,yCoord[indexReihe[i]] + yAbstand ,breite,hoehe);
                    zeigBild("neuesAuge.jpg" ,xCoord[indexReihe[i]] + xAbstand,yCoord[indexReihe[i]] + yAbstand ,breite-4,hoehe-4);
                    ctx.lineWidth="3";
                    ctx.strokeStyle="blue";       
                    ctx.strokeRect(xCoord[indexReihe[i]] + xAbstand,yCoord[indexReihe[i]] + yAbstand ,breite-1,hoehe-1);      
                    //  Hier werden die zu suchenden Zellen anonymisiert
                }            
                clearInterval(id);          
            }    
    }

canv.addEventListener('click', function(event) 
{   
if (blocken==false)
 { 
    ctx.clearRect(xBasis,395-25,300,25);// löscht "falsches Feld....

        xclick = event.clientX;
        yclick = event.clientY; 
        xclick = xclick - xAbstand ;
        yclick = yclick - yAbstand ;
        zaehlerClick++;

        
        let zwert = geklicktesFeld(xclick,yclick) // liefert den Index des getippten feldes 

        if (zwert>=0) 
            {            
                var zw =indexReihe.indexOf(zwert);  //Prüfung auf Treffer bedeutend mit zw > 0  
             
                if (zw>=0)
                        {
                            // Richtige Ziffer == Treffer 
                            zaehlerTreffer++;
                            xxclick=(Math.floor(xclick/breite))*breite;
                            yyclick=(Math.floor(yclick/hoehe))*hoehe; 
                            ctx.clearRect(xCoord[indexReihe[zw]] + xAbstand,yCoord[indexReihe[zw]] + yAbstand ,breite-20,hoehe-20);
                            zeigBild("daumenHoch.png",xCoord[indexReihe[zw]] + xAbstand,yCoord[indexReihe[zw]] + yAbstand ,breite,hoehe);                               
                         
                         }
                        else {    
                            //falsche Feld
                            xxclick=(Math.floor(xclick/breite))*breite;
                            yyclick=(Math.floor(yclick/hoehe))*hoehe;   
                            ctx.clearRect(xBasis,395-30,300,30); 
                            //zeigBild("daumenRunter.png",xCoord[zwert] + xAbstand,yCoord[zwert] + yAbstand ,breite,hoehe);   
                            ctx.clearRect(xBasis ,220-40,600,70); // Schafft Platz für die Meldung Falsches.....
                            meldung("Falsches Feld ==> Go on" ,"bold","16",schriftArt,"blue",xBasis + 44,220);
                           // akustischeMeldung("audio/up.mp3"); 
                            blocken=false;
                            minusPunkte++;                
                            }
            }
            if (zaehlerTreffer == indexReihe.length)
            {
                // Richtige Zahl
                plusPunkte++;                 
               //meldung("Punkte gesamt = " + plusPunkte ,"18",schriftArt,"#5a617b",335,260);  
                //meldung("Versuche : " + (plusPunkte+minusPunkte)  ,"18",schriftArt,"#5a617b",335,340);  
                blocken=false;
                
               if (plusPunkte==5 || plusPunkte==10)
                    {                      
                    zeigBild("merkelkuss.png",60,110,259,250); 
                    }
                setTimeout(function () 
                        {
                           start();
                        }, 1500);
             
            }
        }    
        }, false); 

canv.addEventListener('click', function(e)
     {
        var rect = angetippt(rects, e.offsetX, e.offsetY);        
        if (rect) 
        {
            switch (getipptRechteck) // kommt aus angetippt()
                {
                    case 0:
                        if (blocken==false)
                        {               
                        start();
                        }                      
                    break;
                    case 1:
                        if (blocken==false)
                        {
                        anzahlBilder=plusMinus(anzahlBilder,1,1,25);
                        meldung("Anzahl Bilder: " +  anzahlBilder,"normal","16",schriftArt,"#5a617b",260,420); 
                        }

                        else
                        {
                            ctx.clearRect(260,420-30,500,30); 
                            meldung("Änderung nur bei Neustart oder Fehler möglich","normal","16",schriftArt,"#5a617b",160,420);
                            
                                setTimeout(function () 
                            {
                                ctx.clearRect(160,420-20,440,30);
                                meldung("Anzahl Bilder: " +  anzahlBilder,"normal","16",schriftArt,"#5a617b",260,420);   
                            
                            }, 2000); 

                        }   

                    break; 
                    case 2:
                    if (blocken==false)
                        {                             
                            anzahlBilder=plusMinus(anzahlBilder,-1,1,25); 
                            meldung("Anzahl Bilder: " +  anzahlBilder,"normal","16",schriftArt,"#5a617b",260,420);  
                         }  
                        else
                        {
                            ctx.clearRect(260,420-30,500,30); 
                            meldung("Änderung nur bei Neustart oder Fehler möglich","normal","16",schriftArt,"#5a617b",160,420);
                            
                                setTimeout(function () 
                            {
                                ctx.clearRect(160,420-20,440,30);
                                meldung("Anzahl Bilder: " +  anzahlBilder,"normal","16",schriftArt,"#5a617b",260,420);   
                            
                            }, 2000); 

                        }   
                    break;                                           
                    default:
                    alert("War nichts");
                }                        
        } 
                meldung("Punkte gesamt = " + plusPunkte ,"bold","16",schriftArt,"#5a617b",335,260);  
                meldung("Durchgänge : " + (plusPunkte+minusPunkte)  ,"normal","16",schriftArt,"#5a617b",335,300);  
    }, false);

function aufbauMatrix(zeilen,spalten,breite,hoehe)
{
   // legt eine Matrix an . In derren Elemente werden nachfolgend die ausgewählten Bilder gezeichnet
    for (let i = 0; i<zeilen; i++)
    {
        var y=hoehe*i;
        for(let j=0;j < spalten;j++)
        {            
            var x=breite*j;  
            zeigBild("neuesAuge.jpg",x+xAbstand,y+yAbstand,breite-4,hoehe-4);
            ctx.lineWidth="3";
            ctx.strokeStyle="blue";       
            ctx.strokeRect(x + xAbstand,y + yAbstand,breite,hoehe);   
            //linke, obere Koordinaten der Rechtecke
            xCoord.push(x);
            yCoord.push(y);
         }
    }
            ctx.lineWidth="2";
            ctx.strokeStyle="blue";       
            ctx.strokeRect(xCoord[0]+xAbstand,yCoord[0]+yAbstand,breite*spalten,hoehe*zeilen);    
}

function zeigBild(a,x,y,w,h)
{
    var img = new Image();
    img.onload = function ()
     {
        ctx.drawImage(img, x,y,w,h);
     }
    img.src = a;
}

function auswahlZellen(zeilen,spalten)
{
    // Wählt und zeigt die Zellen an, die gesucht werden sollen
    for (var i =0; i<anzahlBilder;i++)
    {
        var zw =Math.max(0,((random(zeilen*spalten) - 1)));
        console.log(zw);

        if (indexReihe.indexOf(zw) <0)
            {               
                        indexReihe.push(zw);}
                        else
                        {i=i-1;}
                var zu=random(7);
            
                        zeigBild("face/face" + zu + ".png",xCoord[indexReihe[i]] + xAbstand,yCoord[indexReihe[i]] + yAbstand ,breite-4,hoehe-4);
            }   
}

function geklicktesFeld(xc,yc){    // xc und yc sind die Koordinaten des Klicks 
    // Liefert deie Nummer des Feldes wenn ein Klick erfolgte.
    var zw;
    for (var i=0;i<(spaltenZahl*zeilenZahl);i++){

        if ((xCoord[i] < xc) && (xc < xCoord[i] + breite ) &&
            (yCoord[i] < yc) && (yc < yCoord[i]+ hoehe))
            {
            zw=i;    
            }       
     }
     
  return zw;  
}
</script>


</body>
</html>
