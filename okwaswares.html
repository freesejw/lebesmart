<!DOCTYPE html>
<html>
<head>
        <meta charset="utf-8">    
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<style>

Canvas {
   position: absolute;
   top: 0px;
   left: 0px;
   
   background-color: #efefef;
}
</style>
</head>
<body onload="ladeGame()">
 <canvas id="canvas" width="500" height="600"></canvas>
     
<script>
var canv = document.getElementById("canvas");
var ctx = canv.getContext("2d");
var cW = ctx.canvas.width, cH = ctx.canvas.height;  

var xx=0,yy=100;
var indexBilder=[], rennerIndex; 
var myVar; // für setInterval
var getipptRechteck; // gibt an welcher Button / Rechteck angetippt wurde
var schrittWeite=1,maxDurchlaeufe=8;
var durchLaeufe, treffer;
var bgColor="Lavender";
var anzahlBilder=8, pic =new Array, zeigBilder=5;
var vergleichIndex; // dient zur abfrage welcher Button / rechteck angeklickt wurdej
var repeator, blocken=false ;
var quote;
var xBasis=20, yBasis1=280, wBasis1=60, hBasis=40, dBasis=40, xtestdis=20, ytextdis=25;
var yBasis2= 490, wBasis2=120, yErhoehung=50; 
var blocke;
var audio;

var speed;
var zeitSchiene=[1,5,9,12,15,18,21,24,27,30,33,36,39,42,45,48,51,54,57,60];
var speedSchiene=[6,7,8,9,10,11,12,13,14,15,16,17,18,19,21,23,25,27,29,32,34];

//Rechtecke für die Vergleichsbilder

var rects = [{x: xBasis, y: yBasis1, w: wBasis1, h: hBasis,col: ""},
             {x: (xBasis + wBasis1+ dBasis), y: yBasis1, w: wBasis1, h: hBasis,col: "green"},
             {x: (xBasis + 2 * (wBasis1+ dBasis)), y: yBasis1, w: wBasis1, h: hBasis,col: "blue"},
             {x: (xBasis + 3 * (wBasis1+ dBasis)), y: yBasis1, w: wBasis1, h: hBasis,col: "red"},
             {x: (xBasis + 4 * (wBasis1+ dBasis)), y: yBasis1, w: wBasis1, h: hBasis,col: "blue"},

 // Buttons "Go on " usw 
             
             {x: xBasis, y: yBasis2, w: wBasis2, h: hBasis,col: bgColor},
             {x: (xBasis + wBasis2+ dBasis), y: yBasis2, w: wBasis2, h: hBasis,col: bgColor},
             {x: (xBasis + 2 * (wBasis2+ dBasis)), y: yBasis2, w: wBasis2, h: hBasis,col: bgColor},
             {x: (xBasis + 2 * (wBasis2+ dBasis)), y: yBasis2 + yErhoehung, w: wBasis2, h: hBasis,col: bgColor}];
 
var texts =[{na: " Go on", x: xBasis + xtestdis -10, y: yBasis2 + ytextdis},
           {na: "Abbruch", x: (xBasis + xtestdis +  wBasis2 + dBasis),y: yBasis2 + ytextdis} ,
           {na: "Mehr Flitzer", x: (xBasis + xtestdis + 2 * (wBasis2+ dBasis)),y: yBasis2 + ytextdis },
           {na: "Weniger", x: (xBasis + xtestdis + 2 * (wBasis2+ dBasis)),y: yBasis2 + yErhoehung + ytextdis }];

function ladeGame() 
    {   
        meldung("Verbessere Konzentration und visuelle Umsetzung","20","Arial","blue",30, 25);     
           
        meldung("Anzahl Flitzer = " +  maxDurchlaeufe,"18","Arial","blue",xBasis ,380);        
        meldung("Dies war ein Beispiel !!!! Starte mit Go on","bold 24","Arial","blue",xBasis,450);  
        buttonErstellen(5,8);
        buttonText();  // und hier mit Text versehen falls keine bilder genommen werden 
        einlesenFlitzerBilder();
        erstelleBasisBild();  // dient hier nur zur Ansicht
        
        speed=5;
        renner();// dient nur zur Ansicht
        treffer=0;
        durchLaeufe=0;
        anzahlSek=0;
        quote=0;
        var image = new Image();
        image.src = 'hinterGrund1.jpg';
        image.onload = function() 
        {
        ctx.drawImage(image,0,50,500,200); // Hintergrund
        }
      
    }


function start()
{
    ctx.clearRect(xBasis,420-30,400,30); // Kein Treffer
    ctx.clearRect(xBasis,450-30,500,30); // Dies war ein Beispiel

    ctx.clearRect(xBasis,60-25,480,25);
    treffer=0;
    durchLaeufe=0;
    anzahlSek=0;
    blocken=true; 
    var image = new Image();
    image.src = 'hintenGrund1.jpg';
    image.onload = function() {
    ctx.drawImage(image,0,50,500,200);  // Hintergrund
};
   
    myVar=setInterval(zeige,1000); 
  
    }

function zeige()
{
    
    anzahlSek++;
        for (let i = 0;i <zeitSchiene.length;i++)
        {
            if(anzahlSek==zeitSchiene[i])
              {
                speed=speedSchiene[i]; 

                xx=0; // ist die x position vom bild, dass animiert wird
                durchLaeufe++;  
                blocke=false;          
                meldung("Anzahl Flitzer = " +  maxDurchlaeufe,"18","Arial","blue",xBasis ,380); 
                ctx.clearRect(xBasis,yBasis1,550,80);
                erstelleBasisBild();                        
                renner();     
                           
              }
              
        if ( durchLaeufe==maxDurchlaeufe) 
        
            {              
                 
            blocken=false;
            clearInterval(myVar); 
           // abbruch();  
            }     
        }
}

function erstelleBasisBild()
    {
       
        indexBilder=indexVergleichsBilder();                   
        zeichneVergleichsBilder();
        rennerIndex=random(zeigBilder);    
    }

   
function renner()
{  
  // ctx.clearRect(xx, yy-hBasis, -cW, hBasis+80); 
   var image = new Image();
    image.src = 'hinterGrund1.jpg';
    image.onload = function() {
    ctx.drawImage(image,0,50,500,200);// Hintergrund
    }
    var img = new Image();
    img.onload = function () 
        {
        ctx.drawImage(img, xx,yy,150,100);        
        }     
    img.src = pic[indexBilder[rennerIndex]];
    xx=xx+speed;
   
    if(xx>cW+wBasis1)
    { 
        cancelAnimationFrame(repeater) ;    
    }
    else {repeater= requestAnimationFrame(renner);}
 } 
 

canv.addEventListener('click', function(e)
     {
        //console.log(durchLaeufe);
        var rect = angetippt(rects, e.offsetX, e.offsetY);        
        if (rect)
        {          
          
            auswahlButton();            
            if ( (vergleichIndex==indexBilder[rennerIndex]) && ( getipptRechteck<indexBilder.length)&&blocke==false)
                { 
                    treffer++;
                    blocke= true; 

                    ctx.clearRect(xBasis,420-30,500,30); // Kein Treffer     
                    meldung("Treffer . Erreichte Treffer : " + treffer ,"18","Arial","red",xBasis,420);
                                 }  
                else{
                  if (getipptRechteck< 5)  {
                     
                     akustischeMeldung("audio/up.mp3");  
                     meldung("Kein Treffer. Erreichte Treffer : " + treffer ,"18","Arial","red",xBasis,420);     
                }} 
        }
        
        }, false);


//Bestimmt per Zufall die flitzenden bilder 
function indexVergleichsBilder()
    {
        //Bestimmt per Zufall die flitzenden bilder 
        let zww=[];
            for (var i =0; i<zeigBilder;i++)
            {
            var zw =(random(pic.length));    
            if (zww.indexOf(zw) <0)
                {               
                    zww.push(zw);            
                }
            else
                {
                    i=i-1;
                }        
            } 
        return zww;
    }

function abbruch()

    {
       // console.log (durchLaeufe);
        quote=Math.round(treffer/durchLaeufe)*100; 
        ctx.clearRect(xBasis,420-30,400,30); // Kein Treffer
       
         blocken=false;
         clearInterval(myVar);
    }
 
function random(max)
          {
            return Math.floor((Math.random() *max));
          }

function angetippt(rects, x, y) {
    var zw;
    var isCollision = false;
    for (let i = 0, len = rects.length; i < len; i++) {
        var left = rects[i].x, right = rects[i].x+rects[i].w;
        var top = rects[i].y, bottom = rects[i].y+rects[i].h;
        if (right >= x
            && left <= x
            && bottom >= y
            && top <= y) {
                isCollision = rects[i];   
                getipptRechteck=i;
          
                }
    }
    return isCollision;
}

function buttonErstellen(a,b)
{
       for (var i = a;i <= b; i++) {
        ctx.rect(rects[i].x, rects[i].y, rects[i].w, rects[i].h); 
        ctx.stroke();          
        ctx.fillStyle=rects[i].col;         
       ctx.fillRect(rects[i].x, rects[i].y, rects[i].w, rects[i].h);
      }
}

function zeichneVergleichsBilder(){     
    for (let i=0;i<zeigBilder;i++){ 
         zeigBild(pic[indexBilder[i]],i);     
    } 
}

function zeigBild(a,ii)
{
    var img = new Image();
    img.onload = function ()
     {
        ctx.drawImage(img, rects[ii].x, rects[ii].y, rects[ii].w, rects[ii].h);
     }
    img.src = a;
}

function buttonText()
{ 
    ctx.fillStyle = "blue";
    ctx.font = "18px Arial";

    for (var i =0, len = 4; i < len; i++) 
    
    {      
       ctx.fillText(texts[i].na,texts[i].x, texts[i].y);
        
     }
        
}

function plusMinus(ausgang,delta,unten,oben)
{
 // Mehr oder weniger Zeit zum Suchen
  let anz=ausgang; 
  if ((anz + delta)< oben && delta>0)
  {anz=anz + delta; }
  if ((anz + delta)> unten && delta<=0)
  {anz=anz + delta; }
  
  return anz;
}

function akustischeMeldung(a)
    {
        audio = new Audio(a);
        audio.play();
    }

function auswahlButton()
    {
        
        switch (getipptRechteck) 
              {
                    case 0:               
                    case 1:
                    case 2:
                    case 3:
                    case 4:
                    vergleichIndex=indexBilder[getipptRechteck];                   
                    break;   
                    case 5:
                    if ( blocken==false){start(); }                       
                        break;                            
                    case 6:
                        abbruch();                        
                        break;
                    case 7:
                       if (blocken==false){
                            maxDurchlaeufe=plusMinus(maxDurchlaeufe,1,5,20);
                            meldung("Anzahl Flitzer = " +  maxDurchlaeufe,"18","Arial","blue",xBasis ,380);  }                                        
                        break;
                     case 8:
                        if (blocken==false){
                            maxDurchlaeufe=plusMinus(maxDurchlaeufe,-1,5,20);
                            meldung("Anzahl Flitzer = " +  maxDurchlaeufe,"18","Arial","blue",xBasis ,380); 
                       }                                          
                        break;
   

                    default:
                        alert("Sorry");
                }             
    }

    function meldung(text, schriftGroesse,schriftTyp,farbe,xm,ym)
   {
        var lg = 10 + ctx.measureText(text).width 
        ctx.clearRect(xm, ym-schriftGroesse+2,lg,25);
        ctx.fillStyle = farbe;        
        ctx.font = schriftGroesse + "px "+ schriftTyp;
        ctx.fillText(text, xm ,ym); 
    }

function einlesenFlitzerBilder()
    {
        for (i=0;i<= anzahlBilder;i++)
        {
            pic[i]=  "Transport/t" + i + ".png" 
        }
      }

    function akustischeMeldung(a)
    {
        audio = new Audio(a);
        audio.play();
    }

</script>
  


</body>
</html>
