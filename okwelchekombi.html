<!DOCTYPE html>
<html>
<head>
        <meta charset="utf-8">    
<meta name="welche kombi" content="width=device-width, initial-scale=1.0"/>
<style>

Canvas {
   position: absolute;
   top: 0px;
   left: 0px;
   
   background-color: #efefef;
}
</style>
</head>
<body onload="ladeGame()">
    <canvas id="canvas" width="500" height="600"></canvas>
     
<script>
var canv = document.getElementById("canvas");
var ctx = canv.getContext("2d");
var cW = ctx.canvas.width, cH = ctx.canvas.height; 

var warteZeit=3000;
var anzahlKombi=3;

var xBreite=100 , yHoehe=60;
var myVar; // für setInterval
var getipptRechteck; // gibt an welcher Button / Rechteck angetippt wurde
var durchLaeufe, treffer;
var bgColor="Lavender";
var blocken=false ;
var xCoord=[], yCoord=[];
var zeilen = 4, spalten=4;
var getroffen=false;
var zaehlerClick;
var zaehlerTreffer;
var iterator=0;
var audio;
var gesuchtBasis = [], gesuchtNeu=[];

var buch1 =[ "a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];
var buch2 =[ "H","I","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G"];
var zahl = [0,1,2,3,4,5,6,7,8,9,0,1,2,3,4,5,6,7,8,9,0,1,2,3,4,5];

//Rechtecke für die Buttons 

var xAbstand=50,yAbstand = 130;     // Verschiebt die Matrix nach rechts und unten
var xBasis=20, yBasis1=250, wBasis1=60, hBasis=40, dBasis=40, xtestdis=10, ytextdis=25;
var yBasis2= 490, wBasis2=120, yErhoehung=50; 

var rects = [ {x: xBasis, y: yBasis2 + yErhoehung, w: wBasis2, h: hBasis,col: bgColor},
             {x: (xBasis + wBasis2+ dBasis), y: yBasis2 +yErhoehung, w: wBasis2, h: hBasis,col: bgColor},
             {x: (xBasis + 2 * (wBasis2+ dBasis)), y: yBasis2, w: wBasis2, h: hBasis,col: bgColor},
             {x: (xBasis + 2 * (wBasis2+ dBasis)), y: yBasis2 + yErhoehung, w: wBasis2, h: hBasis,col: bgColor}];

// Beschriftung der Buttons

var texts = [{na: "Go on", x: xBasis + xtestdis -10, y: yBasis2 + ytextdis + yErhoehung},
            {na: "Ergebnis", x: (xBasis + xtestdis +  wBasis2 + dBasis),y: yBasis2 + ytextdis + yErhoehung} ,
            {na: "Kombis +", x: (xBasis + xtestdis + 2 * (wBasis2+ dBasis)),y: yBasis2 + ytextdis },
            {na: "Kombis -", x: (xBasis + xtestdis + 2 * (wBasis2+ dBasis)),y: yBasis2 + yErhoehung + ytextdis }];

function ladeGame() 
    {   
        meldung("Verbessere Konzentration und Kurzzeitgedächnis","20","Arial","#5BA9D9",40, 35); 
        meldung("Merke dir die Buchstaben/Zahlenkombination","18","Arial","#5BA9D9",40, 65);    
        meldung("Anzahl","18","Arial","#5BA9D9",330 ,yBasis2-60);
        meldung("Kombinationen = " +  anzahlKombi,"18","Arial","#5BA9D9",330 ,yBasis2-30);

        erzeugeButtone(0,3);// Sind die Buttons
        buttonText();  // und hier mit Text versehen falls keine bilder genommen werden 
        aufbauMatrix(zeilen,spalten,xBreite,yHoehe);
        treffer=0;
        durchLaeufe=0;      
        iterator=0;
    }
   
function start()
{
    ctx.clearRect(xBasis,400-25 ,400,30)
    ctx.clearRect(xBasis,430-25 ,200,30) // Treffer
    ctx.clearRect(xBasis,450-25 ,200,30)  // Meldung falsch
    ctx.clearRect(xBasis,470-25,55,25);  // meldung super

    meldung("Merke dir die Buchstaben/Zahlenkombination","18","Arial","#5BA9D9",40, 65);    
    iterator=-1; 
    zaehlerClick=-1;
    zaehlerTreffer=0;
    durchLaeufe++;
    loescheMatrix();
    aufbauMatrix(zeilen,spalten,xBreite,yHoehe);


    erstellKombination();
    getroffen=false;
    blocken=false;
    myVar=setInterval(zeigeKombinationen,warteZeit); 
}    


canv.addEventListener('click', function(event)
 {   
    if (blocken==false) {      
            xclick = event.clientX; 
            yclick = event.clientY;  
        
    if (xclick>xCoord[0] && (xclick < xCoord[spalten-1]+xBreite)
                         &&  yclick > yCoord[0] &&(yclick<yCoord[zeilen*spalten-1]+yHoehe) 
                         && zaehlerClick<anzahlKombi)
       {
            zaehlerClick++;  
            let zw =gesuchtNeu[geglicktesFeld(xclick,yclick)];
         
           // alert(" zw "+ zw + "zaehlerclick"  + zaehlerClick + " neu  " +gesuchtNeu +" basis  " +gesuchtBasis );

           for ( let i = 0 ;i<=anzahlKombi;i++)
           {    

                    if (zw == gesuchtBasis[i] )
                    {
                        getroffen=true;
                    }
           }
                        
                            if (getroffen==true)
                            { 
                               
                                treffer++;
                                meldung("Treffer =  " + treffer ,"18","Arial","red",xBasis,430);  
                          
                            //xxclick=xAbstand+ (Math.floor(xclick/xBreite))*xBreite;
                            //yyclick=(Math.floor(yclick/yHoehe))*yHoehe;  
                          
                            markiere("green","3");
                           
                             }
                        
                        else {
                            markiere("red","6");                            
                           
                            meldung("Falsch. ==> Go on" ,"18","Arial","red",xBasis,450); 
                            akustischeMeldung("audio/eat.mp3");  
                            rundeAus=true ;
                            blocken=true;                          
                                            
                            }
            
                    if (treffer == anzahlKombi)
                    {
                       
                        meldung("super  " ,"18","Arial","#5BA9D9",xBasis,470);                                           
                    }
            } 
            getroffen=false;   
    }
} , false); 

function markiere(farbe,a)
{
 for (let i=1;i<xCoord.length;i++)
    {
       // console.log("xCordi-1   " +xCoord[i-1] + "  xCord i " +xCoord[i] +" xclick " + xclick) ;
       // console.log("yCordi-1 " + yCoord[i-1] + "  yCord i " + yCoord[i] +" yclick " + yclick) ;
        if((xclick>=xCoord[i-1] && xclick < xCoord[i-1]+xBreite) && (yclick>=yCoord[i-1] && yclick<yCoord[i-1] +yHoehe))
        {
           // console.log("Hallo         xCordi-1 " +xCoord[i-1] + "  xCord i " + xCoord[i] +" xclick " + xclick) ;
           // console.log("Hallo         yCordi-1 " +yCoord[i-1] + "  yCord i " + (yCoord[i-1] +yHoehe) +" yclick " + yclick) ;
            ctx.lineWidth=a;
            ctx.strokeStyle=farbe;
            ctx.strokeRect(xCoord[i-1]+8,yCoord[i-1] + 8  ,xBreite - 8,yHoehe-8);
           
        }
    }  
}

function geglicktesFeld(xc,yc){    // xc und yc sind die Koordinaten des Klicks 
    // Liefert deie Nummer des Feldes wenn ein Klick erfolgte.
    let zw;
    for (let i=0;i<spalten*zeilen;i++){

        if ((xCoord[i] < xc) && (xc < xCoord[i] + xBreite ) &&
            (yCoord[i] < yc) && (yc < yCoord[i]+ yHoehe))
            {
            zw=i;    
            }
        else{
           // console.log(" i =  " ,i,  "   " + "xC[i]  " + xCoord[i]  + "yc[i]  " + yCoord[i]) ;   
            } 
     }
     return zw;  
}

function aufbauMatrix(zeilen,spalten,breite,hoehe)
{
   // legt eine Matrix an . In derren Elemente werden nachfolgend die ausgewählten Bilder gezeichnet
    for (let i = 0; i<zeilen; i++)
    {
        let y=yAbstand+hoehe*i;
        for(let j=0;j < spalten;j++)
        {            
            let x=xAbstand + breite*j;  
            //ctx.lineWidth="1";
           // ctx.strokeStyle="red";       
            //ctx.strokeRect(x,y,xBreite,yHoehe);
            
           //ctx.stroke();
            //linke, obere Koordinaten der Rechtecke
            xCoord.push(x);
            yCoord.push(y);
       
        }
    }  
    //.log(xCoord[15] , yCoord[15]) 
}  

function loescheMatrix()
{
   for (i = 0;i<spalten*zeilen;i++)
    {
        ctx.clearRect(xCoord[i] -5,yCoord[i]-5,xBreite+10,yHoehe+10);
    }
}

function zeigeKombinationen()
{

iterator++;

    if (iterator<anzahlKombi) // zeigt sequentiell die ausgewählten Kombinationen
    {
           ctx.fillStyle = "red";
            ctx.font = "39px Arial";
            ctx.clearRect(200, 200-60,400,80);
            ctx.fillText(gesuchtBasis[iterator], 200,200);           
            console.log(iterator + "  " +gesuchtBasis[iterator]); 
    }   

        if(iterator==anzahlKombi ) // zeigt danach ALLE Kombinationen 
        {
            ctx.clearRect(200, 200-60,400,80);
            meldung("Klicke die vorher gezeigten Kombinationen an","18","Arial","#5BA9D9",40, 65);  
           
            for (let i=0;i<16;i++)
            {
                ctx.fillStyle = "green";
                ctx.font = "30px Arial";
                ctx.fillText(gesuchtNeu[i], xCoord[i]+xtestdis +15, yCoord[i]+ 10+yHoehe/2);            
            }
        }

    if (iterator>anzahlKombi ) // Beenndet das Anzeige und das Ptogramm wartet jetzt auf dien EventListeber Click
        {  
        clearInterval(myVar);
        } 

}

canv.addEventListener('click', function(e)
     {
       // verwaltet die Buttons 
        let rect = angetippt(rects, e.offsetX, e.offsetY);        
        if (rect)
        {          
            auswahlButton();         
               }
                }, false);

function Ergebnis()

    {
        //ctx.clearRect(xBasis,440,400,230,40);   
        meldung("Treffer insgesamt : " + treffer + "  bei :  " +durchLaeufe + "  Durchgängen","18","Arial","red",xBasis,400);
        clearInterval(myVar);
    }
 
function random(max)
          {
            return Math.floor((Math.random() *max));
          }

function angetippt(rects, x, y) {
    let zw;
    let isCollision = false;
    for (let i = 0, len = rects.length; i < len; i++) {
        let left = rects[i].x, right = rects[i].x+rects[i].w;
        let top = rects[i].y, bottom = rects[i].y+rects[i].h;
        if (right >= x
            && left <= x
            && bottom >= y
            && top <= y) {
                isCollision = rects[i];   
                getipptRechteck=i;
          
                }
    }
    return isCollision;
}

function erzeugeButtone(a,b)
{
       for (let i = a;i <= b; i++) {
        ctx.rect(rects[i].x, rects[i].y, rects[i].w, rects[i].h); 
        ctx.stroke();          
        ctx.fillStyle=rects[i].col;         
       ctx.fillRect(rects[i].x, rects[i].y, rects[i].w, rects[i].h);
      }
}

function buttonText()
{ 
    ctx.fillStyle = "#5BA9D9";
    ctx.font = "18px Arial";
    for (let i =0, len = 4; i < len; i++) 
        {      
       ctx.fillText(texts[i].na,texts[i].x, texts[i].y);
        
     }
        
}

function plusMinus(ausgang,delta,unten,oben)
{
        // Mehr oder weniger Zeit zum Suchen
        let anz=ausgang; 
        if ((anz + delta)< oben && delta>0)
        {anz=anz + delta; }
        if ((anz + delta)> unten && delta<=0)
        {anz=anz + delta; }
        
        return anz;
}         

function auswahlButton()
    {
               switch (getipptRechteck) 
              {
                    case 0:
                        start();                       
                        break;                            
                    case 1:
                        Ergebnis();                        
                        break;
                        anzahlKombi= plusMinus(anzahlKombi,-1,0,11);                                      
                    case 2:
                        anzahlKombi= plusMinus(anzahlKombi,1,1,15); 
                        ctx.clearRect(xBasis,320 -20, 300, 20); 
                        meldung("Anzahl","18","Arial","#5BA9D9",330 ,yBasis2-60);
                        meldung("Kombinationen = " +  anzahlKombi,"18","Arial","#5BA9D9",330 ,yBasis2-30);                                   
                        break;
                     case 3:
                        anzahlKombi= plusMinus(anzahlKombi,-1,1,15); 
                        ctx.clearRect(xBasis,320 -20, 300, 20); 
                        meldung("Anzahl","18","Arial","#5BA9D9",330 ,yBasis2-60);
                        meldung("Kombinationen = " +  anzahlKombi,"18","Arial","#5BA9D9",330 ,yBasis2-30);               
                        break;
                        default:
                        alert("Sorry");
                }             
    }

    function meldung(text, schriftGroesse,schriftTyp,farbe,xm,ym)
   {
        var lg = 20 + ctx.measureText(text).width 
        ctx.clearRect(xm, ym-schriftGroesse+2,lg,25);
        ctx.fillStyle = farbe;        
        ctx.font = schriftGroesse + "px "+ schriftTyp;
        ctx.fillText(text, xm ,ym); 
    }

function erstellKombination() {
            
            function shuffleArray(array) {
                for (var i = array.length - 1; i > 0; i--) {
                    var j = Math.floor(Math.random() * (i + 1));
                    var temp = array[i];
                    array[i] = array[j];
                    array[j] = temp;
                }
            }
            function cloneArray(arr) {
                let newArray = [];
                for (let i = 0; i < arr.length; i++) {
                    newArray[i] = arr[i];
                }
                return newArray;
            }

            var zw1 = cloneArray(buch1);
            shuffleArray(zw1);
            var zw2 = cloneArray(buch2);
            shuffleArray(zw2);
            var zw3 = cloneArray(zahl);
            shuffleArray(zw3);
          
            
            for (let i = 0; i < zeilen*spalten; i++) {
                gesuchtBasis[i] = zw1[i] + zw2[i] + zw3[i];
            }
            gesuchtNeu = cloneArray(gesuchtBasis);
            shuffleArray(gesuchtNeu);          
           // console.log("gesuchtBasis  in erstellkombination " + gesuchtBasis);
            //console.log("gesucht neu " + gesuchtNeu);
        }
     


function akustischeMeldung(a)
    {
        audio = new Audio(a);
        audio.play();
    }

</script>
  
<p>Enjoy !</p>

</body>
</html>
