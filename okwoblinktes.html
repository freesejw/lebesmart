<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">   
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<link href='https://fonts.googleapis.com/css?family=Comfortaa' rel='stylesheet'>
<link href="css/standard.css" rel="stylesheet">
<script src="js/standard.js"></script>

<style></style>
</head>
<body onload="ladeGame()">
    <canvas id="canvas" width="500" height="560"></canvas>
     
<script>
var canv = document.getElementById("canvas");
var ctx = canv.getContext("2d");
var cW = ctx.canvas.width, cH = ctx.canvas.height;  

var xBreite=50 , yHoehe=50;
var myVar; // für setInterval
var getipptRechteck; // gibt an welcher Button / Rechteck angetippt wurde
var durchLaeufe, treffer;
var bgColor="Lavender";
var blinkReihe=[];
var vergleichIndex; // dient zur abfrage welcher Button / rechteck angeklickt wurdej
var feldBlocken;
var plusminusBlocker;

var xCoord=[], yCoord=[];
var zeilen = 5, spalten=5;


var xAbstand=80,yAbstand = 100;     // Verschiebt die Matrix nach rechts und unten
var xBasis=20, yBasis1=250, wBasis1=60, hBasis=40, dBasis=40, xtextdis=10, ytextdis=25;
var yBasis2= 440, wBasis2=120, yErhoehung=50; 
var xTextRechts=xBasis + 2 * (wBasis2+ dBasis);

var zaehlerClick,zaehlerTreffer,iterator,anzahlBlinks=4;
var audio;

//Rechtecke für die Bilder
var rects = [{x: xBasis, y: yBasis2 + yErhoehung, w: wBasis2, h: hBasis,col1: "#82CE86",col2:"#82CE86"},
             {x: (xBasis + wBasis2+ dBasis), y: yBasis2 + yErhoehung, w: wBasis2, h: hBasis,col1: "#5a617b",col2: "#5a617b"},                        
             {x: (xBasis + 2 * (wBasis2+ dBasis)), y: yBasis2 + yErhoehung, w: wBasis2, h: hBasis,col1: "#5a617b",col2: "#5a617b"}];



var texts =[{na:  String.fromCharCode(9655)+ "  Go on", x: xBasis + 10, y: yBasis2 + ytextdis+yErhoehung},
           {na: String.fromCharCode(43)+"  Bälle", x: (xBasis + 20 +  wBasis2 + dBasis),y: yBasis2 + ytextdis + yErhoehung},
           {na: String.fromCharCode(45)+"  Bälle", x: (xBasis + 20 + 2 * (wBasis2+ dBasis)),y: yBasis2 + ytextdis + yErhoehung}];
          

function ladeGame() 
    {   
        meldung("Übe die Merkspanne","bold","20",schriftArt,"#5a617b",40, 30);  
        meldung("Merke dir die auftauchenden Bälle : Position + Reihenfolge","normal","16",schriftArt,"#5a617b",40, 60);     
        meldung("Anzahl Bälle = " +  anzahlBlinks,"normal","16",schriftArt,"#5a617b",xTextRechts ,460);
        roundedButton();
        buttonText();  // und hier mit Text versehen falls keine bilder genommen werden 
        aufbauMatrix(zeilen,spalten,xBreite,yHoehe);
        treffer=0;
        durchLaeufe=0;
        plusminusBlocker=false;
        startBlocker=false;
       
     
    }

function start()
    {
        ctx.clearRect(30,380-20,450,20);
       // ctx.clearRect(xBasis ,370,400,30);
        iterator=0; 
        zaehlerClick=0;
        zaehlerTreffer=0;
        durchLaeufe++;
        loescheMatrix();
        aufbauMatrix(zeilen,spalten,xBreite,yHoehe);
        blinkReihe=auswahlBlinkZellen(zeilen,spalten);
        myVar=setInterval(zeige,1000);
        feldBlocken=true; 
        plusminusBlocker=true;
        startBlocker=true;
    }


   
function aufbauMatrix(zeilen,spalten,breite,hoehe)
{
   // legt eine Matrix an . In derren Elemente werden nachfolgend die ausgewählten Bilder gezeichnet
    for (let i = 0; i<zeilen; i++)
    {
        var y=yAbstand+hoehe*i;
        for(let j=0;j < spalten;j++)
        {            
            var x=xAbstand + breite*j;  
            ctx.lineWidth="1";
            ctx.strokeStyle="blue";       
            ctx.strokeRect(x,y,xBreite,yHoehe);            
           
           
            //linke, obere Koordinaten der Rechtecke
            xCoord.push(x);
            yCoord.push(y);
       
        }
    }   
}  

function auswahlBlinkZellen(zeilen,spalten)
{
    var zw=[];
    for (var i =0; i<zeilen*spalten;i++)
        {
            zw.push(i);    
            
        }
    return shuffle(zw);
    }

    canv.addEventListener('click', function(event)
    {   
        if (feldBlocken == false)
        {
                xclick = event.clientX; 
                yclick = event.clientY;  
            
        if (xclick>xCoord[0] && (xclick < xCoord[spalten-1]+xBreite)
                            &&  yclick > yCoord[0] &&(yclick<yCoord[zeilen*spalten-1]+yHoehe))
        {
                zaehlerClick++;        
                var zwert = geglicktesFeld(xclick,yclick) // liefert den Index des getippten feldes 
                var zw =blinkReihe[zaehlerClick];

                
                        if (zw == zwert)
                            {
                                zaehlerTreffer++;
                                xxclick=(Math.floor(xclick/xBreite))*xBreite;
                                yyclick=(Math.floor(yclick/yHoehe))*yHoehe;   
                            // ctx.fillStyle="green";
                                zeigBild("daumenHoch.png",xCoord[blinkReihe[zaehlerClick]] +8 ,yCoord[blinkReihe[zaehlerClick]]+8,40,40);
                            
                            // ctx.fillRect(xCoord[blinkReihe[zaehlerClick]] +8 ,yCoord[blinkReihe[zaehlerClick]]+8 ,xBreite-16,yHoehe-16);
                        
                            }
                            else {
                                    meldung("Falsches Feld oder falsche Reihenfolge ==> Go on" ,"normal","16",schriftArt,"red",30,380);  
                                    zeigBild("daumenRunter.png",xCoord[zwert] +6 ,yCoord[zwert]+6,40,40);
                                    feldBlocken=true;
                                    plusminusBlocker=false; 
                                    startBlocker=false;                              
                                    //akustischeMeldung("audio/up.mp3");   
                                    meldung("Alle geschafft : " + treffer + " mal  " ,"normal","16",schriftArt,"#5a617b",30,420);
                                    meldung("bei :  " +durchLaeufe + "  Durchgängen","normal","16",schriftArt,"#5a617b",30,440);
                                }
                
                        if (zaehlerTreffer == anzahlBlinks)
                        {
                                treffer++
                                meldung("Alle geschafft : " + treffer + " mal","bold","16",schriftArt,"#5a617b",30,420);
                                meldung("bei :  " +durchLaeufe + "  Durchgängen","normal","16",schriftArt,"#5a617b",30,440);
                                if(treffer==5)
                                    {
                                        zeigBild("rakete1.jpg",80,100,250,250);
                                    }
                                if(treffer==10)
                                    {
                                        zeigBild("rakete2.jpg",80,100,250,250);
                                    }
                                    if(treffer==20)
                                    {
                                        zeigBild("rakete3.jpg",80,100,250,250);
                                    }
                                plusminusBlocker=false; 
                                setTimeout(function () 
                                    {
                                    loescheMatrix();
                                        start();
                                    }, 1000);                     
                        }
                }  
        }  

} , false); 



function geglicktesFeld(xc,yc){    // xc und yc sind die Koordinaten des Klicks 
    // Liefert deie Nummer des Feldes wenn ein Klick erfolgte.
    var zw;
    for (var i=0;i<spalten*zeilen;i++){

        if ((xCoord[i] < xc) && (xc < xCoord[i] + xBreite ) &&
            (yCoord[i] < yc) && (yc < yCoord[i]+ yHoehe))
            {
            zw=i;     
            }
        else{
           // console.log(" i =  " ,i,  "   " + "xC[i]  " + xCoord[i]  + "yc[i]  " + yCoord[i]) ;   
            } 
     }  
  return zw;  
}


function loescheMatrix()
{

   for (i = 0;i<spalten*zeilen;i++){
       ctx.clearRect(xCoord[i],yCoord[i],xBreite,yHoehe);
       }
 
}

function zeige()
{
    // Funktion wird von setInterval aufgerufen

    iterator++;

    if (iterator <= anzahlBlinks)
        {
        ctx.beginPath();
        ctx.fillStyle= "red";
        zeigBild("ball.png",xCoord[blinkReihe[iterator]]+5,yCoord[blinkReihe[iterator]]+5,40,40);
        //ctx.arc(xCoord[blinkReihe[iterator]]+25,yCoord[blinkReihe[iterator]]+25,20,0,2*Math.PI);
        ctx.fill();
        ctx.closePath();
        }

    if (iterator>1)
        {
        ctx.clearRect(xCoord[blinkReihe[iterator-1]]+4,yCoord[blinkReihe[iterator-1]]+4,xBreite-8,yHoehe-8);            
        }
    if (iterator>anzahlBlinks)
        {
        ctx.clearRect(xCoord[blinkReihe[iterator]]+4,yCoord[blinkReihe[iterator]]+4,xBreite-8,yHoehe-8);
            clearInterval(myVar);
            feldBlocken=false;  
        }            
  
}

canv.addEventListener('click', function(e)
     {
       // verwaltet die Buttons 
        var rect = angetippt(rects, e.offsetX, e.offsetY);        
        if (rect)
        {          
            auswahlButton();         
               }
                }, false);


function auswahlButton()
    {
               switch (getipptRechteck) 
              {
                   
                    case 0:
                        if(!startBlocker)
                        {
                        start(); 
                        }                      
                        break;                            
                   
                    case 1:                   
                    if (plusminusBlocker==false)
                      {                      
                            anzahlBlinks= plusMinus(anzahlBlinks,1,2,12); 
                            var lg = 20 + ctx.measureText("Anzahl Balle  = " +  anzahlBlinks).width 
                            meldung("Anzahl Balle = " +  anzahlBlinks,"normal","16",schriftArt,"#5a617b",xTextRechts ,460);
                      }
                        break;
                     case 2:
                     if (plusminusBlocker==false)
                        {
                                anzahlBlinks=  plusMinus(anzahlBlinks,-1,2,12);  
                                var lg = 20 + ctx.measureText("Anzahl Bälle  = " +  anzahlBlinks).width 
                                meldung("Anzahl Bälle = " +  anzahlBlinks,"normal","16",schriftArt,"#5a617b",xTextRechts ,460);   
                        }                     
                        break;
                       default:
                        alert("Sorry");
                }             
    }

   


</script>
  


</body>
</html>
