<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">   
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<link href='https://fonts.googleapis.com/css?family=Comfortaa' rel='stylesheet'>
<link href="css/standard.css" rel="stylesheet">
<script src="js/standard.js"></script>

<style></style>
</head>
<body onload="ladeGame()">
    <canvas id="canvas" width="255" height="440"></canvas>
     
<script>
var canv = document.getElementById("canvas");
var ctx = canv.getContext("2d");
var cW = ctx.canvas.width, cH = ctx.canvas.height;  

var xBreite=35 , yHoehe=35;
var myVar; // für setInterval
var getipptRechteck; // gibt an welcher Button / Rechteck angetippt wurde
var durchLauf, treffer;
var bgColor="Lavender";
var blinkReihe=[];
var vergleichIndex; // dient zur abfrage welcher Button / rechteck angeklickt wurdej
var feldBlocken;
var plusminusBlocker;

var xCoord=[], yCoord=[];
var zeilen = 5, spalten=5;


var xAbstand=30,yAbstand = 100;     // Verschiebt die Matrix nach rechts und unten
var xBasis=10, yBasis=360, wBasis=70, hBasis=40, dBasis=10, xtestdis=1, ytextdis=25;
var  yErhoehung=10; 
var xTextRechts=xBasis +  (wBasis+ dBasis);

var zaehlerClick,zaehlerTreffer,iterator,anzahlBlinks=4;
var audio;

//Rechtecke für die Bilder
var rects = [{x: xBasis, y: yBasis + yErhoehung, w: wBasis, h: hBasis,col1: "#82CE86",col2:"#82CE86"},
             {x: (xBasis + wBasis+ dBasis), y: yBasis + yErhoehung, w: wBasis, h: hBasis,col1: "#5a617b",col2: "#5a617b"},                        
             {x: (xBasis + 2 * (wBasis+ dBasis)), y: yBasis + yErhoehung, w: wBasis, h: hBasis,col1: "#5a617b",col2: "#5a617b"}];



var texts =[{na:"Go on", x: xBasis + 10, y: yBasis + ytextdis+yErhoehung},
           {na: String.fromCharCode(43)+" Bälle", x: (xBasis + 8 +  wBasis + dBasis),y: yBasis + ytextdis + yErhoehung},
           {na: String.fromCharCode(45)+" Bälle", x: (xBasis +8 + 2 * (wBasis+ dBasis)),y: yBasis + ytextdis + yErhoehung}];
          

function ladeGame() 
    {   
        meldung("Übe die Merkspanne","bold","20",schriftArt,"#5a617b",20, 30);  
        meldung("Merke die auftauchenden Bälle : ","normal","16",schriftArt,"#5a617b",20, 60);   
        meldung("Position + Reihenfolge","normal","16",schriftArt,"#5a617b",20, 80);     
        meldung("Anzahl Bälle = " +  anzahlBlinks,"normal","16",schriftArt,"#5a617b",xTextRechts + 15,350);
        roundedButton(3);
        buttonText();  // und hier mit Text versehen falls keine bilder genommen werden 
        aufbauMatrix(zeilen,spalten,xBreite,yHoehe);
        treffer=0;
       durchLauf=0;
        plusminusBlocker=false;
        startBlocker=false;
    
    }

function start()
    {
        //ctx.clearRect(30,350-20,450,20);// Falsches Feld....
       // ctx.clearRect(xBasis ,370,400,30);
       if (durchLauf== 0){ ctx.clearRect(20, 60-20,canv.width,45 );} //löscht "finde...."
        iterator=0; 
        zaehlerClick=0;
        zaehlerTreffer=0;
       durchLauf++;
        loescheMatrix();
        aufbauMatrix(zeilen,spalten,xBreite,yHoehe);
        blinkReihe=auswahlBlinkZellen(zeilen,spalten);
        myVar=setInterval(zeige,1000);
        feldBlocken=true; 
        plusminusBlocker=true;
        startBlocker=true;
    }

function zeige()
{
    // Funktion wird von setInterval aufgerufen

    iterator++;

    if (iterator <= anzahlBlinks)
        {
      
        zeigBild("ball.png",xCoord[blinkReihe[iterator]]+2,yCoord[blinkReihe[iterator]]+2,30,30);       
      
        }

    if (iterator>1)
        {
        ctx.clearRect(xCoord[blinkReihe[iterator-1]]+2,yCoord[blinkReihe[iterator-1]]+2,xBreite-6,yHoehe-6);            
        }
    if (iterator>anzahlBlinks)
        {
        ctx.clearRect(xCoord[blinkReihe[iterator]]+4,yCoord[blinkReihe[iterator]]+2,xBreite-6,yHoehe-6);
            clearInterval(myVar);
            feldBlocken=false;  
        }            

}
   
function aufbauMatrix(zeilen,spalten,breite,hoehe)
{
   // legt eine Matrix an . In derren Elemente werden nachfolgend die ausgewählten Bilder gezeichnet
    for (let i = 0; i<zeilen; i++)
    {
        var y=yAbstand+hoehe*i;
        for(let j=0;j < spalten;j++)
        {            
            var x=xAbstand + breite*j;  
            ctx.lineWidth="1";
            ctx.strokeStyle="blue";       
            ctx.strokeRect(x,y,xBreite,yHoehe);            
           
           
            //linke, obere Koordinaten der Rechtecke
            xCoord.push(x);
            yCoord.push(y);
       
        }
    }   
}  

function auswahlBlinkZellen(zeilen,spalten)
{
    var zw=[];
    for (var i =0; i<zeilen*spalten;i++)
        {
            zw.push(i);    
            
        }
    return shuffle(zw);
    }

canv.addEventListener('click', function(event)
    {   
        if (feldBlocken == false)
        {
                xclick = event.clientX; 
                yclick = event.clientY;  
            
        if (xclick>xCoord[0] && (xclick < xCoord[spalten-1]+xBreite)
                            &&  yclick > yCoord[0] &&(yclick<yCoord[zeilen*spalten-1]+yHoehe))
        {
                zaehlerClick++;        
                var zwert = geglicktesFeld(xclick,yclick) // liefert den Index des getippten feldes 
                var zw =blinkReihe[zaehlerClick];

                
                if (zw == zwert)
                    {
                        zaehlerTreffer++;
                        xxclick=(Math.floor(xclick/xBreite))*xBreite;
                        yyclick=(Math.floor(yclick/yHoehe))*yHoehe;                              
                        zeigBild("daumenHoch.png",xCoord[blinkReihe[zaehlerClick]] +3 ,yCoord[blinkReihe[zaehlerClick]]+3,30,30);                                                      
                    }
                    else {
                        zeigBild("daumenRunter.png",xCoord[zwert] +3 ,yCoord[zwert]+3,30,30);
                        feldBlocken=true;
                        plusminusBlocker=false; 
                        startBlocker=false;                          
                        meldung("Geschafft : " + treffer + " bei " +durchLauf + "  Versuch(e)","normal","16",schriftArt,"#5a617b",15,70);
                        }
        
                if (zaehlerTreffer == anzahlBlinks)
                {
                    feldBlocken=true;
                        treffer++
                        meldung("Geschafft : " + treffer + " bei " +durchLauf + "  Versuch(e)","normal","16",schriftArt,"#5a617b",15,70);
                        var aufschlag=0;
                        if(treffer==5)
                            {
                                loescheMatrix();
                                zeigBild("rakete0.jpg",xAbstand,yAbstand,175,175);
                                aufschlag=1500;
                            }
                        if(treffer==10)
                            {
                                zeigBild("rakete1.jpg",xAbstand,yAbstand,175,175);
                                aufschlag=1500;
                            }
                            if(treffer==15)
                            {
                                zeigBild("rakete2.jpg",xAbstand,yAbstand,175,175);
                                aufschlag=1500;
                            }
                            if(treffer==20)
                            {
                                zeigBild("rakete3.jpg",xAbstand,yAbstand,175,175);
                                aufschlag=1500;
                            }
                        plusminusBlocker=false; 
                        setTimeout(function () 
                            {
                            loescheMatrix();
                                start();
                            }, 700+ aufschlag);                     
                }
            }  
        }  

} , false); 



function geglicktesFeld(xc,yc){    // xc und yc sind die Koordinaten des Klicks 
    // Liefert deie Nummer des Feldes wenn ein Klick erfolgte.
    var zw;
    for (var i=0;i<spalten*zeilen;i++){

        if ((xCoord[i] < xc) && (xc < xCoord[i] + xBreite ) &&
            (yCoord[i] < yc) && (yc < yCoord[i]+ yHoehe))
            {
            zw=i;     
            }
        else{
           // console.log(" i =  " ,i,  "   " + "xC[i]  " + xCoord[i]  + "yc[i]  " + yCoord[i]) ;   
            } 
     }  
  return zw;  
}


function loescheMatrix()
{

   for (i = 0;i<spalten*zeilen;i++){
       ctx.clearRect(xCoord[i],yCoord[i],xBreite,yHoehe);
       }
 
}



canv.addEventListener('click', function(e)
     {
       // verwaltet die Buttons 
        var rect = angetippt(rects, e.offsetX, e.offsetY);        
        if (rect)
        {          
            auswahlButton();         
               }
                }, false);


function auswahlButton()
    {
               switch (getipptRechteck) 
              {
                    case 0:
                        if(!startBlocker)
                        {
                        start(); 
                        }                      
                        break;                            
                   
                    case 1: 
                                   
                            anzahlBlinks= plusMinus(anzahlBlinks,1,2,12); 
                            var lg = 20 + ctx.measureText("Anzahl Balle  = " +  anzahlBlinks).width 
                            meldung("Anzahl Bälle = " +  anzahlBlinks,"normal","16",schriftArt,"#5a617b",xTextRechts +15,350);
                     
                    break;
                    case 2:
                                anzahlBlinks=  plusMinus(anzahlBlinks,-1,2,12);  
                                var lg = 20 + ctx.measureText("Anzahl Bälle  = " +  anzahlBlinks).width 
                                meldung("Anzahl Bälle = " +  anzahlBlinks,"normal","16",schriftArt,"#5a617b",xTextRechts + 15 ,350);
                    break;
                    default:
                                alert("Sorry");
                }             
    }

</script>
 
</body>
</html>
